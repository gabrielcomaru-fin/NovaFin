import{r as i,j as e,B as X,D as E,g as ve,f as De,H as Ne,o as $,C as S,a as b,b as I,c as Ce,d as F,h as G}from"./index-e054d3da.js";import{u as Re,L as Se,U as be,T as Ie,P as Fe}from"./ofx-a22ad8b9.js";import{L as U,I as Q,C as Oe}from"./label-ed88c509.js";import{D as Me,a as Pe,P as Le,b as ke,c as Be,d as Ae,e as He}from"./dialog-e2414073.js";import{s as Ve,e as Ye,a as Ue}from"./CompactPeriodFilter-2b2a5a53.js";import"./select-127d756a.js";import{C as qe}from"./badge-1d421c36.js";import{b as v,O as ze}from"./index-105598b5.js";import{T as Xe,a as _e,b as J,c as K}from"./tabs-c5834f45.js";import{f as q}from"./format-36791d56.js";import{s as T,e as W,p as Z,a as $e}from"./index-a49341d7.js";import"./check-circle-2-a27e51b8.js";import"./clock-ad208001.js";import"./shield-check-df8a5410.js";import"./trash-2-a7db4722.js";import"./wallet-ddf46cbb.js";import"./extends-d4fa9dad.js";import"./smartphone-5222ac50.js";import"./building-2-a5b5cc7c.js";import"./index-a53a69e9.js";import"./index-65722b09.js";import"./progress-22404871.js";function Ge({onSubmit:D,incomeToEdit:t,onOpenChange:k,isOpen:N}){const h={descricao:"",valor:"",data:new Date().toISOString().split("T")[0]},[c,u]=i.useState(h),[p,j]=i.useState(""),y=i.useRef(null),B=r=>{if(r==null||r==="")return"";const d=Number(r);return isNaN(d)?"":d.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})};i.useEffect(()=>{t!=null&&t.id?u({descricao:t.descricao||"",valor:B(t.valor),data:t.data?new Date(t.data).toISOString().split("T")[0]:h.data}):u(h),j("")},[t,N]),i.useEffect(()=>{var d;const r=(d=y.current)==null?void 0:d.input;if(r){const g=r.value.length;r.setSelectionRange(g,g)}},[c.valor]);const C=r=>{if(!r)return 0;const d=String(r).replace(/\./g,"").replace(",","."),g=parseFloat(d);return isNaN(g)?0:g},R=r=>{r.preventDefault();const d=C(c.valor);if(d<=0){j("Informe um valor válido maior que zero.");return}if(!c.descricao.trim()||c.descricao.trim().length<3){j("Descrição deve ter pelo menos 3 caracteres.");return}D({...c,valor:d},t==null?void 0:t.id),O()},O=()=>{u(h),j("")},w=r=>{k(r),r||O()},A=r=>{u({...c,valor:r})};return e.jsxs(Me,{open:N,onOpenChange:w,children:[!(t!=null&&t.id)&&e.jsx(Pe,{asChild:!0,children:e.jsxs(X,{children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Nova Receita"]})}),e.jsxs(ke,{className:"sm:max-w-md",children:[e.jsxs(Be,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),t!=null&&t.id?"Editar Receita":"Adicionar Receita"]}),e.jsx(He,{children:t!=null&&t.id?"Atualize os detalhes da sua receita.":"Registre uma nova receita para controlar suas entradas financeiras."})]}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"description",children:"Descrição"}),e.jsx(Q,{id:"description",placeholder:"Ex: Salário mensal, Freelance, Venda",value:c.descricao,onChange:r=>u({...c,descricao:r.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"amount",children:"Valor (R$)"}),e.jsx(Oe,{id:"amount",placeholder:"0,00",value:c.valor,onChange:A,ref:y,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"date",children:"Data"}),e.jsx(Q,{id:"date",type:"date",value:c.data,onChange:r=>u({...c,data:r.target.value}),required:!0})]})]}),p&&e.jsx("p",{className:"text-sm text-red-600",children:p}),e.jsx(X,{type:"submit",className:"w-full",children:t!=null&&t.id?"Salvar Alterações":"Adicionar Receita"})]})]})]})}const z=10,Qe="incomesPage";function ga(){const{incomes:D,addIncome:t,updateIncome:k,deleteIncome:N,categories:h,accounts:c,paymentMethods:u}=ve(),{toast:p}=De(),[j,y]=i.useState(!1),[B,C]=i.useState(null),[R,O]=i.useState(1),[w,A]=i.useState(""),[r,d]=i.useState("date-desc"),[g,H]=i.useState(!1),ee=i.useMemo(()=>h.filter(a=>a.tipo==="receita"),[h]),[s,M]=Re(`filter_${Qe}`,()=>({periodType:"monthly",dateRange:void 0,month:new Date().getMonth(),year:new Date().getFullYear()})),ae=a=>{M({...s,dateRange:a})},se=a=>{M({dateRange:void 0,periodType:"monthly",month:a,year:s.year||new Date().getFullYear()})},te=a=>{M(o=>({...o,dateRange:void 0,year:a}))},re=a=>{M(o=>({...o,periodType:a,dateRange:void 0}))},{filteredIncomes:x,totalIncome:ne,trendData:P,averageIncome:oe,maxIncome:le}=i.useMemo(()=>{let a=[],o,m;if(s.dateRange&&s.dateRange.from){o=s.dateRange.from instanceof Date?s.dateRange.from:new Date(s.dateRange.from);const n=s.dateRange.to||s.dateRange.from;m=n instanceof Date?new Date(n):new Date(n)}else s.periodType==="yearly"&&s.year?(o=Ve(new Date(s.year,0,1)),m=Ye(new Date(s.year,11,31))):s.periodType==="monthly"&&s.month!==void 0&&s.year&&(o=T(new Date(s.year,s.month,1)),m=W(new Date(s.year,s.month,1)));o&&m&&(m=new Date(m),m.setHours(23,59,59,999),a=D.filter(n=>{const l=Z(n.data);return l>=o&&l<=m})),w&&(a=a.filter(n=>n.descricao.toLowerCase().includes(w.toLowerCase()))),a.sort((n,l)=>{switch(r){case"date-asc":return new Date(n.data)-new Date(l.data);case"date-desc":return new Date(l.data)-new Date(n.data);case"value-asc":return n.valor-l.valor;case"value-desc":return l.valor-n.valor;case"description":return n.descricao.localeCompare(l.descricao);default:return new Date(l.data)-new Date(n.data)}});const f=[];for(let n=6;n>=0;n--){const l=s.periodType==="monthly"?new Date(s.year,s.month-n,1):$e(new Date,n),je=T(l),ye=W(l),we=a.filter(Y=>{const L=Z(Y.data);return L>=je&&L<=ye});f.push(we.reduce((Y,L)=>Y+L.valor,0))}const _=a.reduce((n,l)=>n+l.valor,0),ge=a.length>0?_/a.length:0,fe=a.length>0?Math.max(...a.map(n=>n.valor)):0;return{filteredIncomes:a,totalIncome:_,trendData:f,averageIncome:ge,maxIncome:fe}},[D,s,w,r]),V=Math.ceil(x.length/z),ce=x.slice((R-1)*z,R*z),ie=async(a,o)=>{try{o?(await k(o,a),p({title:"Receita atualizada com sucesso!"})):(await t(a),p({title:"Receita adicionada com sucesso!"})),y(!1),C(null)}catch(m){p({title:"Erro ao salvar receita",description:m.message,variant:"destructive"})}},de=a=>{C(a),y(!0)},me=async a=>{try{await N(a),p({title:"Receita excluída com sucesso!"})}catch(o){p({title:"Erro ao excluir receita",description:o.message,variant:"destructive"})}},he=a=>{a>0&&a<=V&&O(a)},ue=a=>{a||C(null),y(a)},pe=async a=>{const o=[];for(const m of a){const f=await t(m);f!=null&&f.id&&o.push(f)}return o},xe=async a=>{for(const o of a)await N(o)};return e.jsxs(e.Fragment,{children:[e.jsxs(Ne,{children:[e.jsx("title",{children:"Controle de Receitas - Lumify"}),e.jsx("meta",{name:"description",content:"Adicione e gerencie suas receitas."})]}),e.jsxs("div",{className:"space-y-3 md:space-y-4 page-top",children:[e.jsx(qe,{title:"Controle de Receitas",subtitle:"Gerencie suas receitas e acompanhe suas entradas financeiras",actionButton:e.jsx(Ge,{onSubmit:ie,incomeToEdit:B,isOpen:j,onOpenChange:ue})}),e.jsxs(Xe,{defaultValue:"relatorio",className:"w-full",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs(_e,{className:"grid w-full md:w-auto grid-cols-2",children:[e.jsxs(J,{value:"relatorio",className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"})," Relatório"]}),e.jsxs(J,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"})," Dashboard"]})]}),e.jsxs("div",{className:"w-full md:w-auto flex items-center gap-2",children:[e.jsxs(X,{variant:"outline",onClick:()=>H(!0),className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"})," Importar OFX"]}),e.jsx(Ue,{periodType:s.periodType,setPeriodType:re,dateRange:s.dateRange,setDateRange:ae,month:s.month,setMonth:se,year:s.year,setYear:te})]})]}),e.jsx(K,{value:"relatorio",className:"mt-4 md:mt-5 space-y-4 md:space-y-5",children:e.jsxs(S,{children:[e.jsxs(b,{children:[e.jsx(I,{children:"Suas Receitas"}),e.jsx(Ce,{children:"Lista de todas as receitas no período selecionado."})]}),e.jsxs(F,{children:[e.jsx(Ie,{transactions:ce,categories:h,accounts:c,paymentMethods:u,type:"income",onEdit:de,onDelete:me,searchTerm:w,onSearchChange:A,sortBy:r,onSortChange:d}),V>1&&e.jsx(Fe,{currentPage:R,totalPages:V,onPageChange:he})]})]})}),e.jsx(K,{value:"dashboard",className:"mt-4 md:mt-5 space-y-4 md:space-y-5",children:e.jsxs("div",{className:"grid gap-3 md:gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(S,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(I,{className:"text-sm font-medium",children:"Total de Receitas"}),e.jsx(E,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(F,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:q(ne)}),e.jsx(v.Sparklines,{data:P,children:e.jsx(v.SparklinesLine,{color:"#22c55e"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total de receitas no período selecionado."})]})]}),e.jsxs(S,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(I,{className:"text-sm font-medium",children:"Número de Receitas"}),e.jsx(G,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(F,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.length}),e.jsx(v.Sparklines,{data:P.map((a,o)=>x.length>0?x.length/P.length:0),children:e.jsx(v.SparklinesLine,{color:"#3b82f6"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Quantidade de receitas registradas."})]})]}),e.jsxs(S,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(I,{className:"text-sm font-medium",children:"Receita Média"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(F,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.length>0?q(oe):"R$ 0,00"}),e.jsx(v.Sparklines,{data:P.map(a=>a/(x.length||1)),children:e.jsx(v.SparklinesLine,{color:"#fbbf24"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Valor médio por receita."})]})]}),e.jsxs(S,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(I,{className:"text-sm font-medium",children:"Maior Receita"}),e.jsx(G,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(F,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:x.length>0?q(le):"R$ 0,00"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Maior valor recebido no período."})]})]})]})})]}),e.jsx(ze,{isOpen:g,onOpenChange:H,type:"income",categories:ee,existingTransactions:D,onImport:pe,onUndoImport:xe,onClose:()=>H(!1)})]})]})}export{ga as IncomesPage};
