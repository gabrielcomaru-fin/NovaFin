import{r as d,j as e,B as _,D as Z,g as ge,f as fe,H as je,n as $,C as N,a as D,b as R,d as ye,e as S,k as G}from"./index-f09e9372.js";import{u as ve,L as we,T as Ne,P as De}from"./Pagination-19873980.js";import{L as H,I as Q,C as Re}from"./label-645ed419.js";import{D as Se,a as Ce,P as be,b as Ie,c as Fe,d as Pe,e as Me}from"./dialog-1eba97ee.js";import{s as Le,e as Oe,C as ke,a as Be}from"./CompactHeader-ab4c6809.js";import"./select-157e3a99.js";import{T as Ae,a as He,b as U,c as J}from"./tabs-49e0ad8d.js";import{b as y}from"./index-e320c511.js";import{f as V}from"./format-36791d56.js";import{s as K,e as W,p as X,a as Ve}from"./index-a49341d7.js";import"./badge-70d13e37.js";import"./trash-2-90f3cb39.js";import"./wallet-f70a395a.js";import"./building-2-aa32fb6d.js";import"./index-a53a69e9.js";import"./index-65722b09.js";function Ye({onSubmit:C,incomeToEdit:t,onOpenChange:L,isOpen:b}){const p={descricao:"",valor:"",data:new Date().toISOString().split("T")[0]},[c,m]=d.useState(p),[h,g]=d.useState(""),f=d.useRef(null),O=r=>{if(r==null||r==="")return"";const i=Number(r);return isNaN(i)?"":i.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})};d.useEffect(()=>{t!=null&&t.id?m({descricao:t.descricao||"",valor:O(t.valor),data:t.data?new Date(t.data).toISOString().split("T")[0]:p.data}):m(p),g("")},[t,b]),d.useEffect(()=>{var i;const r=(i=f.current)==null?void 0:i.input;if(r){const s=r.value.length;r.setSelectionRange(s,s)}},[c.valor]);const v=r=>{if(!r)return 0;const i=String(r).replace(/\./g,"").replace(",","."),s=parseFloat(i);return isNaN(s)?0:s},w=r=>{r.preventDefault();const i=v(c.valor);if(i<=0){g("Informe um valor válido maior que zero.");return}if(!c.descricao.trim()||c.descricao.trim().length<3){g("Descrição deve ter pelo menos 3 caracteres.");return}C({...c,valor:i},t==null?void 0:t.id),I()},I=()=>{m(p),g("")},j=r=>{L(r),r||I()},k=r=>{m({...c,valor:r})};return e.jsxs(Se,{open:b,onOpenChange:j,children:[!(t!=null&&t.id)&&e.jsx(Ce,{asChild:!0,children:e.jsxs(_,{children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Nova Receita"]})}),e.jsxs(Ie,{className:"sm:max-w-md",children:[e.jsxs(Fe,{children:[e.jsxs(Pe,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),t!=null&&t.id?"Editar Receita":"Adicionar Receita"]}),e.jsx(Me,{children:t!=null&&t.id?"Atualize os detalhes da sua receita.":"Registre uma nova receita para controlar suas entradas financeiras."})]}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"description",children:"Descrição"}),e.jsx(Q,{id:"description",placeholder:"Ex: Salário mensal, Freelance, Venda",value:c.descricao,onChange:r=>m({...c,descricao:r.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"amount",children:"Valor (R$)"}),e.jsx(Re,{id:"amount",placeholder:"0,00",value:c.valor,onChange:k,ref:f,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"date",children:"Data"}),e.jsx(Q,{id:"date",type:"date",value:c.data,onChange:r=>m({...c,data:r.target.value}),required:!0})]})]}),h&&e.jsx("p",{className:"text-sm text-red-600",children:h}),e.jsx(_,{type:"submit",className:"w-full",children:t!=null&&t.id?"Salvar Alterações":"Adicionar Receita"})]})]})]})}const Y=10,qe="incomesPage";function ta(){const{incomes:C,addIncome:t,updateIncome:L,deleteIncome:b,categories:p,accounts:c,paymentMethods:m}=ge(),{toast:h}=fe(),[g,f]=d.useState(!1),[O,v]=d.useState(null),[w,I]=d.useState(1),[j,k]=d.useState(""),[r,i]=d.useState("date-desc"),[s,F]=ve(`filter_${qe}`,()=>({periodType:"monthly",dateRange:void 0,month:new Date().getMonth(),year:new Date().getFullYear()})),T=a=>{F({...s,dateRange:a})},E=a=>{F({dateRange:void 0,periodType:"monthly",month:a,year:s.year||new Date().getFullYear()})},ee=a=>{F(l=>({...l,dateRange:void 0,year:a}))},ae=a=>{F(l=>({...l,periodType:a,dateRange:void 0}))},{filteredIncomes:u,totalIncome:se,trendData:P,averageIncome:te,maxIncome:re}=d.useMemo(()=>{let a=[],l,x;s.dateRange&&s.dateRange.from?(l=s.dateRange.from,x=s.dateRange.to||s.dateRange.from):s.periodType==="yearly"&&s.year?(l=Le(new Date(s.year,0,1)),x=Oe(new Date(s.year,11,31))):s.periodType==="monthly"&&s.month!==void 0&&s.year&&(l=K(new Date(s.year,s.month,1)),x=W(new Date(s.year,s.month,1))),l&&x&&(x.setHours(23,59,59,999),a=C.filter(n=>{const o=X(n.data);return o>=l&&o<=x})),j&&(a=a.filter(n=>n.descricao.toLowerCase().includes(j.toLowerCase()))),a.sort((n,o)=>{switch(r){case"date-asc":return new Date(n.data)-new Date(o.data);case"date-desc":return new Date(o.data)-new Date(n.data);case"value-asc":return n.valor-o.valor;case"value-desc":return o.valor-n.valor;case"description":return n.descricao.localeCompare(o.descricao);default:return new Date(o.data)-new Date(n.data)}});const q=[];for(let n=6;n>=0;n--){const o=s.periodType==="monthly"?new Date(s.year,s.month-n,1):Ve(new Date,n),ue=K(o),xe=W(o),pe=a.filter(A=>{const M=X(A.data);return M>=ue&&M<=xe});q.push(pe.reduce((A,M)=>A+M.valor,0))}const z=a.reduce((n,o)=>n+o.valor,0),me=a.length>0?z/a.length:0,he=a.length>0?Math.max(...a.map(n=>n.valor)):0;return{filteredIncomes:a,totalIncome:z,trendData:q,averageIncome:me,maxIncome:he}},[C,s,j,r]),B=Math.ceil(u.length/Y),ne=u.slice((w-1)*Y,w*Y),le=async(a,l)=>{try{l?(await L(l,a),h({title:"Receita atualizada com sucesso!"})):(await t(a),h({title:"Receita adicionada com sucesso!"})),f(!1),v(null)}catch(x){h({title:"Erro ao salvar receita",description:x.message,variant:"destructive"})}},oe=a=>{v(a),f(!0)},ce=async a=>{try{await b(a),h({title:"Receita excluída com sucesso!"})}catch(l){h({title:"Erro ao excluir receita",description:l.message,variant:"destructive"})}},ie=a=>{a>0&&a<=B&&I(a)},de=a=>{a||v(null),f(a)};return e.jsxs(e.Fragment,{children:[e.jsxs(je,{children:[e.jsx("title",{children:"Controle de Receitas - Lumify"}),e.jsx("meta",{name:"description",content:"Adicione e gerencie suas receitas."})]}),e.jsxs("div",{className:"space-y-3 md:space-y-4 page-top",children:[e.jsx(ke,{title:"Controle de Receitas",subtitle:"Gerencie suas receitas e acompanhe suas entradas financeiras",actionButton:e.jsx(Ye,{onSubmit:le,incomeToEdit:O,isOpen:g,onOpenChange:de})}),e.jsxs(Ae,{defaultValue:"relatorio",className:"w-full",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs(He,{className:"grid w-full md:w-auto grid-cols-2",children:[e.jsxs(U,{value:"relatorio",className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"})," Relatório"]}),e.jsxs(U,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"})," Dashboard"]})]}),e.jsx("div",{className:"w-full md:w-auto flex items-center gap-2",children:e.jsx(Be,{periodType:s.periodType,setPeriodType:ae,dateRange:s.dateRange,setDateRange:T,month:s.month,setMonth:E,year:s.year,setYear:ee})})]}),e.jsx(J,{value:"relatorio",className:"mt-4 md:mt-5 space-y-4 md:space-y-5",children:e.jsxs(N,{children:[e.jsxs(D,{children:[e.jsx(R,{children:"Suas Receitas"}),e.jsx(ye,{children:"Lista de todas as receitas no período selecionado."})]}),e.jsxs(S,{children:[e.jsx(Ne,{transactions:ne,categories:p,accounts:c,paymentMethods:m,type:"income",onEdit:oe,onDelete:ce,searchTerm:j,onSearchChange:k,sortBy:r,onSortChange:i}),B>1&&e.jsx(De,{currentPage:w,totalPages:B,onPageChange:ie})]})]})}),e.jsx(J,{value:"dashboard",className:"mt-4 md:mt-5 space-y-4 md:space-y-5",children:e.jsxs("div",{className:"grid gap-3 md:gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(N,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Total de Receitas"}),e.jsx(Z,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:V(se)}),e.jsx(y.Sparklines,{data:P,children:e.jsx(y.SparklinesLine,{color:"#22c55e"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total de receitas no período selecionado."})]})]}),e.jsxs(N,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Número de Receitas"}),e.jsx(G,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.length}),e.jsx(y.Sparklines,{data:P.map((a,l)=>u.length>0?u.length/P.length:0),children:e.jsx(y.SparklinesLine,{color:"#3b82f6"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Quantidade de receitas registradas."})]})]}),e.jsxs(N,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Receita Média"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.length>0?V(te):"R$ 0,00"}),e.jsx(y.Sparklines,{data:P.map(a=>a/(u.length||1)),children:e.jsx(y.SparklinesLine,{color:"#fbbf24"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Valor médio por receita."})]})]}),e.jsxs(N,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Maior Receita"}),e.jsx(G,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.length>0?V(re):"R$ 0,00"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Maior valor recebido no período."})]})]})]})})]})]})]})}export{ta as IncomesPage};
