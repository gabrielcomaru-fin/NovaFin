import{e as ce,g as fe,r as f,j as e,B as U,q as le,D as je,C as M,a as $,b as I,c as z,d as k,R as Ye,p as ie,f as We,s as de,h as me,l as Xe,H as Ke,t as re}from"./index-d0ea6d6a.js";import{u as Je,L as Ze,U as ea,T as aa,P as sa,O as ta}from"./OFXImportDialog-e47170ea.js";import{L as H,I as he,C as ra}from"./label-cb1f6f9b.js";import{S as na,a as oa,b as la,c as ia,d as ca}from"./select-16594779.js";import{D as da,a as ma,P as ha,b as ua,c as ga,d as xa,e as pa,C as Q}from"./dialog-eae6d4ca.js";import{C as ne,s as fa,e as ja,a as va}from"./CompactPeriodFilter-ea56c5d3.js";import{C as Na,E as ya}from"./ExpenseTrendChart-640a891c.js";import{g as ba,B as ve,f as wa,R as Ne,C as ye,T as be,L as Ca}from"./generateCategoricalChart-3eba9fad.js";import{P as Sa,a as Da}from"./CategoryChart-7f46d9f7.js";import{W as ue}from"./wallet-b404b181.js";import{B as Pa,S as Ma,F as ka}from"./smartphone-4570318b.js";import{B as Ra}from"./building-2-42858704.js";import{X as we,Y as Ce,C as Fa}from"./YAxis-3b899a13.js";import{C as $a}from"./badge-88e11e09.js";import{T as Ia,a as Aa,b as ge,c as xe}from"./tabs-3beb4e2c.js";import{b as K}from"./index-b4a8ec58.js";import{T as Ba}from"./trash-2-1492001f.js";import{C as La}from"./check-circle-2-73519f16.js";import"./clock-16b511b3.js";import"./shield-check-3771e06e.js";import"./extends-6c7ae844.js";import"./index-aad4f46d.js";import"./index-9abce2a2.js";import"./trending-down-8bd2c2d9.js";const pe=ce("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),Ta=ce("CheckSquare",[["polyline",{points:"9 11 12 14 22 4",key:"19ybtz"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]),Oa=ce("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]);function _a({onSubmit:y,expenseToEdit:c,onOpenChange:b,isOpen:h}){const{categories:w}=fe(),D=w.filter(i=>i.tipo==="gasto"),o={descricao:"",valor:"",categoria_id:"",recorrente:!1,pago:!1,data:new Date().toISOString().split("T")[0]},[t,l]=f.useState(o),[d,j]=f.useState(""),g=f.useRef(null),v=i=>{if(i==null||i==="")return"";const F=Number(i);return isNaN(F)?"":F.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})};f.useEffect(()=>{c!=null&&c.id?l({descricao:c.descricao||"",valor:v(c.valor),categoria_id:c.categoria_id||"",recorrente:c.recorrente||!1,pago:c.pago||!1,data:c.data?new Date(c.data).toISOString().split("T")[0]:o.data}):l(o),j("")},[c,h]),f.useEffect(()=>{var F;const i=(F=g.current)==null?void 0:F.input;if(i){const T=i.value.length;i.setSelectionRange(T,T)}},[t.valor]);const C=i=>{if(!i)return 0;const F=String(i).replace(/\./g,"").replace(",","."),T=parseFloat(F);return isNaN(T)?0:T},S=i=>{i.preventDefault();const F=C(t.valor);if(F<=0){j("Informe um valor vÃ¡lido maior que zero.");return}if(!t.categoria_id){j("Por favor, selecione uma categoria para a despesa.");return}y({...t,valor:F},c==null?void 0:c.id),R()},R=()=>{l(o),j("")},A=i=>{b(i),i||R()},J=i=>{l({...t,valor:i})};return e.jsxs(da,{open:h,onOpenChange:A,children:[!(c!=null&&c.id)&&e.jsx(ma,{asChild:!0,children:e.jsxs(U,{children:[e.jsx(ha,{className:"w-4 h-4 mr-2"}),"Nova Despesa"]})}),e.jsxs(ua,{className:"sm:max-w-md",children:[e.jsxs(ga,{children:[e.jsxs(xa,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),c!=null&&c.id?"Editar Despesa":"Adicionar Despesa"]}),e.jsx(pa,{children:c!=null&&c.id?"Atualize os detalhes da sua despesa.":"Registre uma nova despesa para controlar seus gastos."})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"description",children:"DescriÃ§Ã£o"}),e.jsx(he,{id:"description",placeholder:"Ex: AlmoÃ§o no restaurante",value:t.descricao,onChange:i=>l({...t,descricao:i.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"amount",children:"Valor (R$)"}),e.jsx(ra,{id:"amount",placeholder:"0,00",value:t.valor,onChange:J,ref:g,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"date",children:"Data"}),e.jsx(he,{id:"date",type:"date",value:t.data,onChange:i=>l({...t,data:i.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"category",children:"Categoria"}),D.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(na,{value:t.categoria_id,onValueChange:i=>{l({...t,categoria_id:i}),j("")},children:[e.jsx(oa,{children:e.jsx(la,{placeholder:"Selecione uma categoria"})}),e.jsx(ia,{children:D.map(i=>e.jsx(ca,{value:i.id.toString(),children:i.nome},i.id))})]}),d&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma categoria de gasto disponÃ­vel."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"isRecurring",checked:t.recorrente,onChange:i=>l({...t,recorrente:i.target.checked}),className:"rounded accent-primary"}),e.jsxs(H,{htmlFor:"isRecurring",className:"flex items-center gap-2 text-sm",children:[e.jsx(Oa,{className:"w-4 h-4"}),"Despesa recorrente"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"isPaid",checked:t.pago,onChange:i=>l({...t,pago:i.target.checked}),className:"rounded accent-primary"}),e.jsxs(H,{htmlFor:"isPaid",className:"flex items-center gap-2 text-sm",children:[e.jsx(je,{className:"w-4 h-4"}),"Despesa jÃ¡ paga"]})]})]}),e.jsx(U,{type:"submit",className:"w-full",children:c!=null&&c.id?"Salvar AlteraÃ§Ãµes":"Adicionar Despesa"})]})]})]})}var za=ba({chartName:"BarChart",GraphicalChild:ve,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:we},{axisType:"yAxis",AxisComp:Ce}],formatAxisMap:wa});const Ga=y=>{if(!y)return"hsl(var(--primary))";if(!document.documentElement.classList.contains("dark"))return y;let b,h,w;if(y.startsWith("#")){const o=y.replace("#","");b=parseInt(o.substring(0,2),16),h=parseInt(o.substring(2,4),16),w=parseInt(o.substring(4,6),16)}else if(y.startsWith("rgb")){const o=y.match(/\d+/g);if(o&&o.length>=3)b=parseInt(o[0]),h=parseInt(o[1]),w=parseInt(o[2]);else return"hsl(var(--primary))"}else return"hsl(var(--primary))";const D=(.299*b+.587*h+.114*w)/255;if(D<.5){const d=Math.max(.6,D*2.5)/D;let j=Math.min(255,Math.round(b*d)),g=Math.min(255,Math.round(h*d)),v=Math.min(255,Math.round(w*d));return Math.max(j,g,v)<150?"hsl(var(--primary))":`rgb(${j}, ${g}, ${v})`}return y},Va=f.memo(function({expenses:c,paymentMethods:b}){const h=f.useMemo(()=>!c.length||!b.length?[]:b.map(l=>{const d=c.filter(g=>g.meio_pagamento_id===l.id),j=d.reduce((g,v)=>g+v.valor,0);return{name:l.nome,value:j,color:l.cor||"#3b82f6",tipo:l.tipo,count:d.length}}).filter(l=>l.value>0).sort((l,d)=>d.value-l.value),[c,b]),w=t=>({cartao_credito:Q,cartao_debito:Q,dinheiro:Pa,pix:Ma,transferencia:Ra,boleto:ka,outros:ue})[t]||ue,D=({active:t,payload:l})=>{if(t&&l&&l.length){const d=l[0].payload;return e.jsxs("div",{className:"bg-background border border-border rounded-lg p-3 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[Ye.createElement(w(d.tipo),{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:d.name})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Valor: R$ ",d.value.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["TransaÃ§Ãµes: ",d.count]})]})}return null},o=({payload:t})=>e.jsx("div",{className:"flex flex-wrap gap-2 justify-center mt-4",children:t.map((l,d)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:l.color}}),e.jsx("span",{className:"text-muted-foreground",children:l.value})]},d))});return h.length===0?e.jsxs(M,{children:[e.jsxs($,{children:[e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"DistribuiÃ§Ã£o por Meio de Pagamento"]}),e.jsx(z,{children:"Nenhuma despesa encontrada com meios de pagamento"})]}),e.jsx(k,{children:e.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[e.jsx(Q,{className:"w-12 h-12 mx-auto opacity-50 mb-2"}),e.jsx("p",{children:"Nenhuma despesa registrada com meio de pagamento"})]})})]}):e.jsxs(M,{children:[e.jsxs($,{children:[e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"DistribuiÃ§Ã£o por Meio de Pagamento"]}),e.jsx(z,{children:"Como vocÃª distribui seus gastos entre diferentes meios de pagamento"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"h-80",children:e.jsx(Ne,{width:"100%",height:"100%",children:e.jsxs(Sa,{children:[e.jsx(Da,{data:h,cx:"50%",cy:"50%",innerRadius:60,outerRadius:120,paddingAngle:2,dataKey:"value",children:h.map((t,l)=>e.jsx(ye,{fill:t.color},`cell-${l}`))}),e.jsx(be,{content:e.jsx(D,{})}),e.jsx(Ca,{content:e.jsx(o,{})})]})})}),e.jsx("div",{className:"mt-4 space-y-2",children:h.map((t,l)=>{const d=w(t.tipo),j=h.reduce((g,v)=>g+v.value,0)>0?t.value/h.reduce((g,v)=>g+v.value,0)*100:0;return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-4 w-4",style:{color:Ga(t.color)||"hsl(var(--primary))"}}),e.jsx("span",{className:"font-medium text-card-foreground",children:t.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold",children:["R$ ",t.value.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[j.toFixed(1),"% â€¢ ",t.count," transaÃ§Ã£o",t.count!==1?"Ãµes":""]})]})]},l)})})]})]})}),qa=f.memo(function({expenses:c,periodType:b="monthly"}){const h=f.useMemo(()=>{if(!c.length)return[];const o={Segunda:0,TerÃ§a:0,Quarta:0,Quinta:0,Sexta:0,SÃ¡bado:0,Domingo:0},t={Segunda:0,TerÃ§a:0,Quarta:0,Quinta:0,Sexta:0,SÃ¡bado:0,Domingo:0},l=["Domingo","Segunda","TerÃ§a","Quarta","Quinta","Sexta","SÃ¡bado"];return c.forEach(d=>{const j=ie(d.data),g=l[j.getDay()];o.hasOwnProperty(g)&&(o[g]+=d.valor,t[g]+=1)}),Object.entries(o).map(([d,j])=>({day:d,total:j,count:t[d],average:t[d]>0?j/t[d]:0}))},[c]),w=f.useMemo(()=>{if(h.length===0)return[];const o=[],t=[...h].sort((C,S)=>S.total-C.total),l=[...h].sort((C,S)=>S.average-C.average);t[0]&&t[0].total>0&&o.push({type:"info",icon:"ðŸ“Š",title:"Dia com Maior Gasto",message:`${t[0].day} Ã© o dia que vocÃª mais gasta (R$ ${t[0].total.toLocaleString("pt-BR",{minimumFractionDigits:2})})`}),l[0]&&l[0].average>0&&o.push({type:"tip",icon:"ðŸ’¡",title:"Dia com Maior Gasto MÃ©dio",message:`${l[0].day} tem o maior gasto mÃ©dio por transaÃ§Ã£o (R$ ${l[0].average.toLocaleString("pt-BR",{minimumFractionDigits:2})})`});const d=["Segunda","TerÃ§a","Quarta","Quinta","Sexta"],j=["SÃ¡bado","Domingo"],g=d.reduce((C,S)=>{const R=h.find(A=>A.day===S);return C+((R==null?void 0:R.total)||0)},0),v=j.reduce((C,S)=>{const R=h.find(A=>A.day===S);return C+((R==null?void 0:R.total)||0)},0);if(g>0&&v>0){const C=v/(g+v)*100;C>40&&o.push({type:"warning",icon:"âš ï¸",title:"Gastos de Fim de Semana",message:`${C.toFixed(1)}% dos seus gastos acontecem nos fins de semana. Considere planejar melhor essas despesas.`})}return o},[h]),D=({active:o,payload:t,label:l})=>{if(o&&t&&t.length){const d=t[0].payload;return e.jsxs("div",{className:"bg-background border border-border rounded-lg p-3 shadow-lg",children:[e.jsx("p",{className:"font-medium",children:l}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Total: R$ ",d.total.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["TransaÃ§Ãµes: ",d.count]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["MÃ©dia: R$ ",d.average.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})}return null};return h.length===0||h.every(o=>o.total===0)?e.jsxs(M,{children:[e.jsxs($,{children:[e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"PadrÃµes de Gastos por Dia da Semana"]}),e.jsx(z,{children:"Nenhuma despesa encontrada para anÃ¡lise"})]}),e.jsx(k,{children:e.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[e.jsx(ne,{className:"w-12 h-12 mx-auto opacity-50 mb-2"}),e.jsx("p",{children:"Nenhuma despesa registrada para anÃ¡lise de padrÃµes"})]})})]}):e.jsxs(M,{children:[e.jsxs($,{children:[e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"PadrÃµes de Gastos por Dia da Semana"]}),e.jsx(z,{children:"Como vocÃª distribui seus gastos ao longo da semana"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"h-80",children:e.jsx(Ne,{width:"100%",height:"100%",children:e.jsxs(za,{data:h,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(Fa,{strokeDasharray:"3 3",className:"opacity-30"}),e.jsx(we,{dataKey:"day",tick:{fontSize:12},tickLine:{stroke:"hsl(var(--muted-foreground))"}}),e.jsx(Ce,{tick:{fontSize:12},tickLine:{stroke:"hsl(var(--muted-foreground))"},tickFormatter:o=>`R$ ${(o/1e3).toFixed(0)}k`}),e.jsx(be,{content:e.jsx(D,{})}),e.jsx(ve,{dataKey:"total",radius:[4,4,0,0],children:h.map((o,t)=>e.jsx(ye,{fill:o.day==="SÃ¡bado"||o.day==="Domingo"?"#f59e0b":"#3b82f6"},`cell-${t}`))})]})})}),w.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:w.map((o,t)=>e.jsx("div",{className:`p-3 rounded-lg border ${o.type==="warning"?"bg-orange-50 border-orange-200":o.type==="tip"?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:o.icon}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:o.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o.message})]})]})},t))})]})]})}),oe=10,Ea="expensesPage";function fs(){const{expenses:y,categories:c,paymentMethods:b,addExpense:h,updateExpense:w,deleteExpense:D,toggleExpensePayment:o}=fe(),{toast:t}=We(),[l,d]=f.useState(!1),[j,g]=f.useState(null),[v,C]=f.useState(1),[S,R]=f.useState(""),[A,J]=f.useState("all"),[i,F]=f.useState("all"),[T,Se]=f.useState("date-desc"),[De,Z]=f.useState(!1),V=f.useMemo(()=>c.filter(a=>a.tipo==="gasto"),[c]),[u,Y]=Je(`filter_${Ea}`,()=>({periodType:"monthly",dateRange:void 0,month:new Date().getMonth(),year:new Date().getFullYear()})),Pe=a=>{Y({...u,dateRange:a})},Me=a=>{Y({dateRange:void 0,periodType:"monthly",month:a,year:u.year||new Date().getFullYear()})},ke=a=>{Y(s=>({...s,dateRange:void 0,year:a}))},Re=a=>{Y(s=>({...s,periodType:a,dateRange:void 0}))},Fe=async a=>{const s=[];for(const n of a){const x=await h(n);x!=null&&x.id&&s.push(x)}return s},$e=async a=>{for(const s of a)await D(s)},{filteredExpenses:p,totalSpent:B,trendData:r,paidExpenses:Ha,pendingExpenses:Qa,totalPaid:ee,totalPending:Ie}=f.useMemo(()=>{let a=[],s,n;if(u.dateRange&&u.dateRange.from){s=u.dateRange.from instanceof Date?u.dateRange.from:new Date(u.dateRange.from);const m=u.dateRange.to||u.dateRange.from;n=m instanceof Date?new Date(m):new Date(m)}else u.periodType==="yearly"&&u.year?(s=fa(new Date(u.year,0,1)),n=ja(new Date(u.year,11,31))):u.periodType==="monthly"&&u.month!==void 0&&u.year&&(s=de(new Date(u.year,u.month,1)),n=me(new Date(u.year,u.month,1)));s&&n?(n=new Date(n),n.setHours(23,59,59,999),a=y.filter(m=>{const N=ie(m.data);return N>=s&&N<=n})):a=y,S&&(a=a.filter(m=>m.descricao.toLowerCase().includes(S.toLowerCase()))),A!=="all"&&(a=a.filter(m=>m.categoria_id===A)),i!=="all"&&(a=a.filter(m=>i==="paid"?m.pago===!0:i==="pending"?m.pago===!1:!0)),a.sort((m,N)=>{switch(T){case"date-asc":return new Date(m.data)-new Date(N.data);case"date-desc":return new Date(N.data)-new Date(m.data);case"value-asc":return m.valor-N.valor;case"value-desc":return N.valor-m.valor;case"description":return m.descricao.localeCompare(N.descricao);default:return new Date(N.data)-new Date(m.data)}});const x=[];for(let m=6;m>=0;m--){const N=u.periodType==="monthly"?new Date(u.year,u.month-m,1):Xe(new Date,m),He=de(N),Qe=me(N),Ue=y.filter(te=>{const X=ie(te.data);return X>=He&&X<=Qe});x.push(Ue.reduce((te,X)=>te+X.valor,0))}const P=a.reduce((m,N)=>m+N.valor,0),L=a.filter(m=>m.pago===!0),_=a.filter(m=>m.pago===!1),se=L.reduce((m,N)=>m+N.valor,0),G=_.reduce((m,N)=>m+N.valor,0);return{filteredExpenses:a,totalSpent:P,trendData:x,paidExpenses:L,pendingExpenses:_,totalPaid:se,totalPending:G}},[y,u,S,A,i,T]);f.useMemo(()=>{if(p.length===0)return[];const a=V.reduce((s,n)=>(s[n.id]={categoryName:n.nome,total:0},s),{});return p.forEach(s=>{a[s.categoria_id]&&(a[s.categoria_id].total+=s.valor)}),Object.values(a).filter(s=>s.total>0).sort((s,n)=>n.total-s.total)},[p,V]);const ae=Math.ceil(p.length/oe),Ae=p.slice((v-1)*oe,v*oe),[q,W]=f.useState([]),E=q.length,Be=(a,s)=>{W(n=>s?Array.from(new Set([...n,a])):n.filter(x=>x!==a))},Le=(a,s)=>{W(s?Array.from(new Set([...q,...a])):q.filter(n=>!a.includes(n)))},Te=async()=>{if(E!==0)try{for(const a of q)await o(a);t({title:"AtualizaÃ§Ã£o concluÃ­da",description:`${E} lanÃ§amento(s) atualizados`}),W([])}catch(a){t({title:"Erro ao atualizar em lote",description:a.message,variant:"destructive"})}},Oe=async()=>{if(E!==0)try{for(const a of q)await D(a);t({title:"ExclusÃ£o concluÃ­da",description:`${E} lanÃ§amento(s) excluÃ­dos`}),W([])}catch(a){t({title:"Erro ao excluir em lote",description:a.message,variant:"destructive"})}},_e=async(a,s)=>{try{s?(await w(s,a),t({title:"Despesa atualizada com sucesso!"})):(await h(a),t({title:"Despesa adicionada com sucesso!"})),d(!1),g(null)}catch(n){t({title:"Erro ao salvar despesa",description:n.message,variant:"destructive"})}},ze=a=>{g({...a,categories:V}),d(!0)},Ge=async a=>{try{await D(a),t({title:"Despesa excluÃ­da com sucesso!"})}catch(s){t({title:"Erro ao excluir despesa",description:s.message,variant:"destructive"})}},Ve=async a=>{try{await o(a),t({title:"Status de pagamento atualizado!"})}catch(s){t({title:"Erro ao atualizar status",description:s.message,variant:"destructive"})}},qe=a=>{a>0&&a<=ae&&C(a)},Ee=a=>{a||g(null),d(a)},O=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"});return e.jsxs(e.Fragment,{children:[e.jsxs(Ke,{children:[e.jsx("title",{children:"Controle de Despesas - Lumify"}),e.jsx("meta",{name:"description",content:"Adicione e gerencie suas despesas."})]}),e.jsxs("div",{className:"space-y-3 md:space-y-4 page-top",children:[e.jsx($a,{title:"Controle de Despesas",subtitle:"Gerencie suas despesas e acompanhe seus gastos",actionButton:e.jsx(_a,{onSubmit:_e,expenseToEdit:j,isOpen:l,onOpenChange:Ee})}),e.jsxs(Ia,{defaultValue:"relatorio",className:"w-full",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs(Aa,{className:"grid w-full md:w-auto grid-cols-2",children:[e.jsxs(ge,{value:"relatorio",className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4"})," RelatÃ³rio"]}),e.jsxs(ge,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"})," Dashboard"]})]}),e.jsxs("div",{className:"w-full md:w-auto flex items-center gap-2",children:[e.jsxs(U,{variant:"outline",onClick:()=>Z(!0),className:"flex items-center gap-2",children:[e.jsx(ea,{className:"h-4 w-4"})," Importar OFX"]}),e.jsx(va,{periodType:u.periodType,setPeriodType:Re,dateRange:u.dateRange,setDateRange:Pe,month:u.month,setMonth:Me,year:u.year,setYear:ke})]})]}),e.jsx(xe,{value:"relatorio",className:"mt-4 md:mt-5 space-y-4 md:space-y-5",children:e.jsxs(M,{children:[e.jsxs($,{children:[e.jsx(I,{children:"Suas Despesas"}),e.jsx(z,{children:"Lista de todas as despesas no perÃ­odo selecionado."})]}),e.jsxs(k,{children:[E>0&&e.jsxs("div",{className:"mb-2 flex items-center gap-2 text-sm",children:[e.jsxs("div",{className:"text-muted-foreground",children:["Selecionados: ",E]}),e.jsxs(U,{variant:"outline",size:"sm",onClick:Te,className:"flex items-center gap-2",children:[e.jsx(Ta,{className:"h-4 w-4"})," Marcar como pago"]}),e.jsxs(U,{variant:"destructive",size:"sm",onClick:Oe,className:"flex items-center gap-2",children:[e.jsx(Ba,{className:"h-4 w-4"})," Excluir"]})]}),e.jsx(aa,{transactions:Ae,categories:V,paymentMethods:b,type:"expense",onEdit:ze,onDelete:Ge,onTogglePayment:Ve,onUpdatePaymentMethod:w,selectable:!0,selectedIds:q,onSelectOne:Be,onSelectAll:Le,searchTerm:S,onSearchChange:R,selectedCategory:A,onCategoryChange:J,paymentStatus:i,onPaymentStatusChange:F,sortBy:T,onSortChange:Se}),ae>1&&e.jsx(sa,{currentPage:v,totalPages:ae,onPageChange:qe})]})]})}),e.jsx(xe,{value:"dashboard",className:"mt-4 md:mt-5 space-y-4 md:space-y-5",children:p.length===0?e.jsx(M,{children:e.jsxs(k,{className:"text-center py-8",children:[e.jsx(le,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhuma despesa encontrada"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:S||A!=="all"||i!=="all"?"Tente ajustar os filtros para ver suas despesas.":"Adicione algumas despesas para ver o dashboard completo."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-3 md:gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(M,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(I,{className:"text-sm font-medium",children:"Gasto Total"}),e.jsx(je,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:O.format(B)}),e.jsx(K.Sparklines,{data:r,children:e.jsx(K.SparklinesLine,{color:"#f87171"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.length>1&&r[r.length-1]>r[r.length-2]?`+${((r[r.length-1]-r[r.length-2])/r[r.length-2]*100).toFixed(1)}% vs anterior`:r.length>1&&r[r.length-1]<r[r.length-2]?`${((r[r.length-1]-r[r.length-2])/r[r.length-2]*100).toFixed(1)}% vs anterior`:"Primeiro perÃ­odo"})]})]}),e.jsxs(M,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(I,{className:"text-sm font-medium",children:"Status de Pagamento"}),e.jsx(La,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:O.format(ee)}),e.jsxs("div",{className:"text-sm text-orange-600 font-medium",children:[O.format(Ie)," pendente"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full transition-all duration-300",style:{width:B>0?`${ee/B*100}%`:"0%"}})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[B>0?`${Math.round(ee/B*100)}%`:"0%"," quitado"]})]})]}),e.jsxs(M,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(I,{className:"text-sm font-medium",children:"Despesa MÃ©dia"}),e.jsx(re,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.length>0?O.format(B/p.length):"R$ 0,00"}),e.jsx(K.Sparklines,{data:r.map(a=>a/(p.length||1)),children:e.jsx(K.SparklinesLine,{color:"#fbbf24"})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[p.length," transaÃ§Ã£o",p.length!==1?"Ãµes":""," registrada",p.length!==1?"s":""]})]})]}),e.jsxs(M,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(I,{className:"text-sm font-medium",children:"Maior Gasto"}),e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:p.length>0?O.format(Math.max(...p.map(a=>a.valor))):"R$ 0,00"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p.length>0?(()=>{var n,x;const a=Math.max(...p.map(P=>P.valor)),s=p.find(P=>P.valor===a);return((n=s==null?void 0:s.descricao)==null?void 0:n.substring(0,20))+(((x=s==null?void 0:s.descricao)==null?void 0:x.length)>20?"...":"")})():"Nenhuma despesa"})]})]})]}),e.jsxs(M,{children:[e.jsxs($,{children:[e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"AnÃ¡lise por Meio de Pagamento"]}),e.jsx(z,{children:"Como vocÃª estÃ¡ gastando seu dinheiro"})]}),e.jsx(k,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map(a=>{const s=p.filter(L=>L.meio_pagamento_id===a.id),n=s.reduce((L,_)=>L+_.valor,0),x=B>0?n/B*100:0;if(n===0)return null;const P=L=>({cartao_credito:"ðŸ’³",cartao_debito:"ðŸ’³",dinheiro:"ðŸ’µ",pix:"ðŸ“±",transferencia:"ðŸ¦",boleto:"ðŸ“„",outros:"ðŸ’¼"})[L]||"ðŸ’¼";return e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:P(a.tipo)}),e.jsx("span",{className:"font-medium",children:a.nome})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[x.toFixed(1),"%"]})]}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:O.format(n)}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-300",style:{width:`${x}%`,backgroundColor:a.cor||"#3b82f6"}})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.length," transaÃ§Ã£o",s.length!==1?"Ãµes":""]})]},a.id)})})})]}),e.jsxs(M,{children:[e.jsxs($,{children:[e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"ComparaÃ§Ã£o Temporal"]}),e.jsx(z,{children:"EvoluÃ§Ã£o dos seus gastos ao longo do tempo"})]}),e.jsx(k,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:r.slice(-3).map((a,s)=>{const n=s===r.slice(-3).length-1,x=r[r.length-3+s-1],P=x&&x>0?(a-x)/x*100:0,L=(G,m)=>n?"PerÃ­odo Atual":G===m-2?"MÃªs Anterior":G===m-3?"AntepenÃºltimo MÃªs":`MÃªs ${m-G}`,_=Math.max(...r.filter(G=>G>0)),se=_>0?a/_*100:0;return e.jsxs("div",{className:`p-4 border rounded-lg ${n?"border-primary bg-primary/5":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:L(s,r.slice(-3).length)}),P!==0&&!isNaN(P)&&e.jsxs("span",{className:`text-xs ${P>0?"text-red-600":"text-green-600"}`,children:[P>0?"â†—":"â†˜"," ",Math.abs(P).toFixed(1),"%"]})]}),e.jsx("div",{className:"text-2xl font-bold",children:O.format(a)}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-300",style:{width:`${se}%`,backgroundColor:n?"#3b82f6":"#94a3b8"}})})]},s)})})})]}),e.jsxs(M,{children:[e.jsxs($,{children:[e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5 text-primary"}),"Insights Financeiros"]}),e.jsx(z,{children:"AnÃ¡lises personalizadas dos seus gastos"})]}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[(()=>{const a=b.map(s=>({method:s,total:p.filter(n=>n.meio_pagamento_id===s.id).reduce((n,x)=>n+x.valor,0)})).filter(s=>s.total>0).sort((s,n)=>n.total-s.total);if(a.length>0){const s=a[0],n=s.total/B*100;return e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ’³"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Meio de Pagamento Preferido"}),e.jsxs("p",{className:"text-sm text-blue-700",children:["VocÃª usa ",e.jsx("strong",{children:s.method.nome})," para ",n.toFixed(1),"% dos seus gastos (",O.format(s.total),").",n>70&&" Considere diversificar seus meios de pagamento para melhor controle."]})]})]})})}return null})(),(()=>{const a=V.map(s=>({category:s,total:p.filter(n=>n.categoria_id===s.id).reduce((n,x)=>n+x.valor,0)})).filter(s=>s.total>0).sort((s,n)=>n.total-s.total);if(a.length>0){const s=a[0],n=s.total/B*100;return e.jsx("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ“Š"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-orange-900",children:"Categoria com Maior Gasto"}),e.jsxs("p",{className:"text-sm text-orange-700",children:[e.jsx("strong",{children:s.category.nome})," representa ",n.toFixed(1),"% dos seus gastos (",O.format(s.total),").",n>50&&" Esta categoria estÃ¡ consumindo mais da metade do seu orÃ§amento."]})]})]})})}return null})(),r.length>1&&e.jsx("div",{className:`p-4 border rounded-lg ${r[r.length-1]>r[r.length-2]?"bg-red-50 border-red-200":"bg-green-50 border-green-200"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-2xl",children:r[r.length-1]>r[r.length-2]?"ðŸ“ˆ":"ðŸ“‰"}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-medium ${r[r.length-1]>r[r.length-2]?"text-red-900":"text-green-900"}`,children:"TendÃªncia de Gastos"}),e.jsx("p",{className:`text-sm ${r[r.length-1]>r[r.length-2]?"text-red-700":"text-green-700"}`,children:r[r.length-1]>r[r.length-2]?`Seus gastos aumentaram ${((r[r.length-1]-r[r.length-2])/r[r.length-2]*100).toFixed(1)}% em relaÃ§Ã£o ao perÃ­odo anterior.`:`Seus gastos diminuÃ­ram ${Math.abs((r[r.length-1]-r[r.length-2])/r[r.length-2]*100).toFixed(1)}% em relaÃ§Ã£o ao perÃ­odo anterior.`})]})]})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-5",children:[e.jsx(Na,{expenses:p,categories:c}),e.jsx(Va,{expenses:p,paymentMethods:b})]}),e.jsx(qa,{expenses:p}),e.jsx(ya,{})]})})]}),e.jsx(ta,{isOpen:De,onOpenChange:Z,type:"expense",categories:V,paymentMethods:b,existingTransactions:y,onImport:Fe,onUndoImport:$e,onClose:()=>Z(!1)})]})]})}export{fs as ExpensesPage};
