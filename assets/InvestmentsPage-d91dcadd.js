import{e as Ht,r as o,q as zt,s as dt,j as e,t as qe,v as We,w as Xt,x as Yt,y as Ut,z as Ze,E as Kt,g as mt,f as ut,B as T,h as Ve,F as Jt,G as Qt,I as Wt,J as Zt,T as pt,i as es,H as ts,o as ye,C as q,a as G,b as $,c as et,d as H,D as tt}from"./index-e054d3da.js";import{u as ss,L as as,U as rs,T as os,P as ns,p as is}from"./ofx-a22ad8b9.js";import{C as st}from"./CategoryChart-96990a77.js";import{L as Q,I as at,C as rt}from"./label-ed88c509.js";import{S as W,a as Z,b as ee,c as te,d as Y}from"./select-127d756a.js";import{D as be,a as ot,P as cs,b as Ce,c as we,d as De,e as nt,f as ls}from"./dialog-e2414073.js";import{B as ds,C as ms}from"./badge-1d421c36.js";import{S as us}from"./shield-check-df8a5410.js";import{s as ps,e as hs,a as xs}from"./CompactPeriodFilter-2b2a5a53.js";import{T as fs,a as gs,b as it,c as ct}from"./tabs-c5834f45.js";import{s as ie,e as ce,p as ue,a as Te}from"./index-a49341d7.js";import{e as Le}from"./index-9eaf3fc2.js";import{f as lt}from"./index-65722b09.js";import{p as js}from"./index-23bf3cd3.js";import{A as vs}from"./alert-circle-c5aff930.js";import"./check-circle-2-a27e51b8.js";import"./clock-ad208001.js";import"./trash-2-a7db4722.js";import"./wallet-ddf46cbb.js";import"./extends-d4fa9dad.js";import"./smartphone-5222ac50.js";import"./building-2-a5b5cc7c.js";import"./generateCategoricalChart-328cfce8.js";import"./index-a53a69e9.js";const Ns=Ht("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);function ys(d){const c=o.useRef({value:d,previous:d});return o.useMemo(()=>(c.current.value!==d&&(c.current.previous=c.current.value,c.current.value=d),c.current.previous),[d])}var Se="Checkbox",[bs,Ws]=zt(Se),[Cs,Ge]=bs(Se);function ws(d){const{__scopeCheckbox:c,checked:j,children:S,defaultChecked:C,disabled:h,form:y,name:g,onCheckedChange:D,required:F,value:I="on",internal_do_not_use_render:k}=d,[u,v]=Ut({prop:j,defaultProp:C??!1,onChange:D,caller:Se}),[R,_]=o.useState(null),[A,w]=o.useState(null),b=o.useRef(!1),z=R?!!y||!!R.closest("form"):!0,P={checked:u,disabled:h,setChecked:v,control:R,setControl:_,name:g,form:y,value:I,hasConsumerStoppedPropagationRef:b,required:F,defaultChecked:U(C)?!1:C,isFormControl:z,bubbleInput:A,setBubbleInput:w};return e.jsx(Cs,{scope:c,...P,children:Ds(k)?k(P):S})}var ht="CheckboxTrigger",xt=o.forwardRef(({__scopeCheckbox:d,onKeyDown:c,onClick:j,...S},C)=>{const{control:h,value:y,disabled:g,checked:D,required:F,setControl:I,setChecked:k,hasConsumerStoppedPropagationRef:u,isFormControl:v,bubbleInput:R}=Ge(ht,d),_=dt(C,I),A=o.useRef(D);return o.useEffect(()=>{const w=h==null?void 0:h.form;if(w){const b=()=>k(A.current);return w.addEventListener("reset",b),()=>w.removeEventListener("reset",b)}},[h,k]),e.jsx(qe.button,{type:"button",role:"checkbox","aria-checked":U(D)?"mixed":D,"aria-required":F,"data-state":Nt(D),"data-disabled":g?"":void 0,disabled:g,value:y,...S,ref:_,onKeyDown:We(c,w=>{w.key==="Enter"&&w.preventDefault()}),onClick:We(j,w=>{k(b=>U(b)?!0:!b),R&&v&&(u.current=w.isPropagationStopped(),u.current||w.stopPropagation())})})});xt.displayName=ht;var $e=o.forwardRef((d,c)=>{const{__scopeCheckbox:j,name:S,checked:C,defaultChecked:h,required:y,disabled:g,value:D,onCheckedChange:F,form:I,...k}=d;return e.jsx(ws,{__scopeCheckbox:j,checked:C,defaultChecked:h,disabled:g,required:y,onCheckedChange:F,name:S,form:I,value:D,internal_do_not_use_render:({isFormControl:u})=>e.jsxs(e.Fragment,{children:[e.jsx(xt,{...k,ref:c,__scopeCheckbox:j}),u&&e.jsx(vt,{__scopeCheckbox:j})]})})});$e.displayName=Se;var ft="CheckboxIndicator",gt=o.forwardRef((d,c)=>{const{__scopeCheckbox:j,forceMount:S,...C}=d,h=Ge(ft,j);return e.jsx(Xt,{present:S||U(h.checked)||h.checked===!0,children:e.jsx(qe.span,{"data-state":Nt(h.checked),"data-disabled":h.disabled?"":void 0,...C,ref:c,style:{pointerEvents:"none",...d.style}})})});gt.displayName=ft;var jt="CheckboxBubbleInput",vt=o.forwardRef(({__scopeCheckbox:d,...c},j)=>{const{control:S,hasConsumerStoppedPropagationRef:C,checked:h,defaultChecked:y,required:g,disabled:D,name:F,value:I,form:k,bubbleInput:u,setBubbleInput:v}=Ge(jt,d),R=dt(j,v),_=ys(h),A=Yt(S);o.useEffect(()=>{const b=u;if(!b)return;const z=window.HTMLInputElement.prototype,K=Object.getOwnPropertyDescriptor(z,"checked").set,L=!C.current;if(_!==h&&K){const le=new Event("click",{bubbles:L});b.indeterminate=U(h),K.call(b,U(h)?!1:h),b.dispatchEvent(le)}},[u,_,h,C]);const w=o.useRef(U(h)?!1:h);return e.jsx(qe.input,{type:"checkbox","aria-hidden":!0,defaultChecked:y??w.current,required:g,disabled:D,name:F,value:I,form:k,...c,tabIndex:-1,ref:R,style:{...c.style,...A,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});vt.displayName=jt;function Ds(d){return typeof d=="function"}function U(d){return d==="indeterminate"}function Nt(d){return U(d)?"indeterminate":d?"checked":"unchecked"}const yt=o.forwardRef(({className:d,...c},j)=>e.jsx($e,{ref:j,className:Ze("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",d),...c,children:e.jsx(gt,{className:Ze("flex items-center justify-center text-current"),children:e.jsx(Kt,{className:"h-4 w-4"})})}));yt.displayName=$e.displayName;function Ss({onSubmit:d,investmentToEdit:c,onOpenChange:j,isOpen:S}){const{investmentGoal:C,handleSetInvestmentGoal:h,categories:y,accounts:g}=mt(),{toast:D}=ut(),F=y.filter(r=>r.tipo==="investimento"),I={descricao:"",valor_aporte:"",categoria_id:"",instituicao_id:"",data:new Date().toISOString().split("T")[0],is_reserva_emergencia:!1},k={goal:""},[u,v]=o.useState(I),[R,_]=o.useState(k),[A,w]=o.useState(!1),b=o.useRef(null),z=o.useRef(null),P=r=>{if(r==null||r==="")return"";const p=Number(r);return isNaN(p)?"":p.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})};o.useEffect(()=>{var r,p;c!=null&&c.id?v({descricao:c.descricao||"",valor_aporte:P(c.valor_aporte),categoria_id:((r=c.categoria_id)==null?void 0:r.toString())||"",instituicao_id:((p=c.instituicao_id)==null?void 0:p.toString())||"",data:c.data?new Date(c.data).toISOString().split("T")[0]:I.data,is_reserva_emergencia:c.is_reserva_emergencia||!1}):v(I)},[c,S]),o.useEffect(()=>{_({goal:P(C)})},[C,A]),o.useEffect(()=>{var p;const r=(p=b.current)==null?void 0:p.input;if(r){const O=r.value.length;r.setSelectionRange(O,O)}},[u.valor_aporte]),o.useEffect(()=>{var p;const r=(p=z.current)==null?void 0:p.input;if(r){const O=r.value.length;r.setSelectionRange(O,O)}},[R.goal]);const K=r=>{if(typeof r=="number")return r;if(!r)return 0;const p=String(r).replace(/\./g,"").replace(",","."),O=parseFloat(p);return isNaN(O)?0:O},L=r=>{r.preventDefault();const p=K(u.valor_aporte);if(p<=0){D({title:"Erro",description:"Informe um valor de aporte v√°lido maior que zero.",variant:"destructive"});return}d({...u,valor_aporte:p},c==null?void 0:c.id),v(I)},le=r=>{j(r),r||v(I)},se=(r,p)=>{v({...u,[p]:r})},Ie=r=>{_({goal:r})},ke=async r=>{r.preventDefault();const p=K(R.goal);if(isNaN(p)||p<0){D({title:"Erro",description:"Defina um valor v√°lido para a meta.",variant:"destructive"});return}try{await h(p)}catch{D({title:"Erro",description:"N√£o foi poss√≠vel salvar a meta.",variant:"destructive"});return}D({title:"Meta atualizada!",description:`Nova meta mensal: R$ ${p.toLocaleString("pt-BR",{minimumFractionDigits:2})}`}),w(!1)};return e.jsxs("div",{className:"flex items-center gap-2",children:[Number(C)>0&&e.jsxs(ds,{variant:"secondary",children:["Meta atual: R$ ",Number(C).toLocaleString("pt-BR",{minimumFractionDigits:2}),"/m√™s"]}),e.jsxs(be,{open:S,onOpenChange:le,children:[!(c!=null&&c.id)&&e.jsx(ot,{asChild:!0,children:e.jsxs(T,{children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Novo Aporte"]})}),e.jsxs(Ce,{children:[e.jsxs(we,{children:[e.jsxs(De,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5 text-primary"}),c!=null&&c.id?"Editar Aporte":"Registrar Investimento"]}),e.jsx(nt,{children:c!=null&&c.id?"Atualize os detalhes do seu aporte.":"Adicione um novo aporte para seus investimentos."})]}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"description",children:"Descri√ß√£o (Opcional)"}),e.jsx(at,{id:"description",placeholder:"Ex: Aporte mensal",value:u.descricao,onChange:r=>v({...u,descricao:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"amount",children:"Valor do Aporte (R$)"}),e.jsx(rt,{id:"amount",placeholder:"0,00",value:u.valor_aporte,onChange:r=>se(r,"valor_aporte"),ref:b,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"date",children:"Data"}),e.jsx(at,{id:"date",type:"date",value:u.data,onChange:r=>v({...u,data:r.target.value}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"category",children:"Categoria"}),F.length>0?e.jsxs(W,{value:u.categoria_id,onValueChange:r=>v({...u,categoria_id:r}),required:!0,children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"Selecione uma categoria"})}),e.jsx(te,{children:F.map(r=>e.jsx(Y,{value:r.id.toString(),children:r.nome},r.id))})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma categoria de investimento dispon√≠vel."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"institution",children:"Institui√ß√£o Financeira"}),g.length>0?e.jsxs(W,{value:u.instituicao_id,onValueChange:r=>v({...u,instituicao_id:r}),required:!0,children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"Selecione uma institui√ß√£o"})}),e.jsx(te,{children:g.map(r=>e.jsx(Y,{value:r.id.toString(),children:r.nome_banco},r.id))})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma institui√ß√£o financeira dispon√≠vel."})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg border bg-muted/30",children:[e.jsx(yt,{id:"is_reserva_emergencia",checked:u.is_reserva_emergencia,onCheckedChange:r=>v({...u,is_reserva_emergencia:r===!0})}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(us,{className:"h-4 w-4 text-emerald-500"}),e.jsx(Q,{htmlFor:"is_reserva_emergencia",className:"text-sm font-medium cursor-pointer flex-1",children:"Este aporte faz parte da Reserva de Emerg√™ncia"}),e.jsx(Jt,{children:e.jsxs(Qt,{children:[e.jsx(Wt,{asChild:!0,children:e.jsx(Ns,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),e.jsx(Zt,{side:"top",className:"max-w-xs",children:e.jsx("p",{className:"text-sm",children:"Marque se este aporte comp√µe sua reserva de emerg√™ncia. Isso ajuda a calcular corretamente sua sa√∫de financeira e quantos meses de gastos voc√™ tem guardados."})})]})})]})]}),e.jsx(T,{type:"submit",className:"w-full",children:c!=null&&c.id?"Salvar Altera√ß√µes":"Registrar Aporte"})]})]})]}),e.jsxs(be,{open:A,onOpenChange:w,children:[e.jsx(ot,{asChild:!0,children:e.jsxs(T,{variant:"outline",children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"Definir Meta"]})}),e.jsxs(Ce,{children:[e.jsxs(we,{children:[e.jsx(De,{children:"Definir Meta de Aportes"}),e.jsx(nt,{children:"Defina sua meta mensal de investimentos para acompanhar seu progresso."})]}),e.jsxs("form",{onSubmit:ke,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"goalAmount",children:"Meta Mensal (R$)"}),e.jsx(rt,{id:"goalAmount",placeholder:"0,00",value:R.goal,onChange:Ie,ref:z,required:!0})]}),e.jsx(T,{type:"submit",className:"w-full",children:"Definir Meta"})]})]})]})]})}const Ee=10,Is="investmentsPage";function Zs(){var Ke,Je;const{investments:d,categories:c,accounts:j,addInvestment:S,updateInvestment:C,deleteInvestment:h,investmentGoal:y}=mt(),{toast:g}=ut(),{addPoints:D,registerAction:F,evaluateAchievements:I,setMetaMonthHit:k}=es(),[u,v]=o.useState(!1),[R,_]=o.useState(null),[A,w]=o.useState(1),[b,z]=o.useState("relatorio"),[P,K]=o.useState(""),[L,le]=o.useState("all"),[se,Ie]=o.useState("date-desc"),[ke,r]=o.useState(!1),[p,O]=o.useState(!1),[E,Re]=o.useState([]),[de,pe]=o.useState({}),[he,xe]=o.useState({}),[me,fe]=o.useState({}),[ae,_e]=o.useState([]),[bt,Me]=o.useState(!1),[Fe,re]=o.useState({}),X=o.useMemo(()=>c.filter(t=>t.tipo==="investimento"),[c]),ge=((Ke=X[0])==null?void 0:Ke.id)||"",je=((Je=j[0])==null?void 0:Je.id)||"",[oe,He]=o.useState(ge),[ne,ze]=o.useState(je),Xe="ofx-investments-file-input",[n,ve]=ss(`filter_${Is}`,()=>({periodType:"monthly",dateRange:void 0,month:new Date().getMonth(),year:new Date().getFullYear()})),Ct=t=>{ve({...n,dateRange:t})},wt=t=>{ve({dateRange:void 0,periodType:"monthly",month:t,year:n.year||new Date().getFullYear()})},Dt=t=>{ve(a=>({...a,dateRange:void 0,year:t}))},St=t=>{ve(a=>({...a,periodType:t,dateRange:void 0}))};o.useEffect(()=>{w(1)},[P,L,se,n,b]),o.useEffect(()=>{!oe&&ge&&He(ge)},[ge,oe]),o.useEffect(()=>{!ne&&je&&ze(je)},[je,ne]);const It=t=>{const a=[];return t.forEach((s,m)=>{var x;const l=s.data,i=((x=s.descricao)==null?void 0:x.toLowerCase().trim())||"",N=Number(s.valor)||0,f=d.find(M=>{var Qe;const Be=M.data,Ne=((Qe=M.descricao)==null?void 0:Qe.toLowerCase().trim())||"",$t=Number(M.valor_aporte)||0;return Be===l&&Ne===i&&Math.abs($t-N)<.01});f&&a.push({ofxIndex:m,ofxTransaction:s,existingInvestment:f})}),a},kt=()=>{const t=document.getElementById(Xe);t&&t.click()},Rt=async t=>{const a=t.target.files&&t.target.files[0];if(a)try{const m=(await is(a)).filter(i=>i.valor<0||String(i.tipo).toUpperCase()==="DEBIT").map(i=>({...i,valor:Math.abs(i.valor)}));if(m.length===0){g({title:"Nenhum aporte encontrado no OFX",description:"Verifique se o arquivo cont√©m lan√ßamentos de sa√≠da relacionados a investimentos.",variant:"destructive"}),t.target.value="";return}const l=It(m);_e(l),re({}),Re(m),pe({}),xe(m.reduce((i,N,f)=>(i[f]=N.descricao||"Aporte OFX",i),{})),fe({}),l.length>0?Me(!0):r(!0)}catch(s){g({title:"Falha ao ler OFX",description:(s==null?void 0:s.message)||"Formato inv√°lido.",variant:"destructive"})}finally{t.target.value=""}},_t=async()=>{const t=E.some((s,m)=>de[m])||!!oe,a=E.some((s,m)=>me[m])||!!ne;if(!t||!a){g({title:"Selecione categoria e institui√ß√£o",description:"Defina ao menos a categoria e a institui√ß√£o padr√£o ou por item.",variant:"destructive"});return}O(!0);try{let s=0,m=0;for(let i=0;i<E.length;i++){const N=E[i];if(ae.find(Ne=>Ne.ofxIndex===i)&&Fe[i]==="skip"){m++;continue}const x=de[i]||oe,M=me[i]||ne;if(!x||!M)continue;const Be={descricao:he[i]??N.descricao??"Aporte OFX",valor_aporte:Number(N.valor)||0,categoria_id:x,instituicao_id:M,data:N.data||new Date().toISOString().split("T")[0]};try{await S(Be),s++}catch{}}let l=`${s} aportes adicionados`;m>0&&(l+=`, ${m} duplicatas ignoradas`),g({title:"Importa√ß√£o conclu√≠da",description:l}),r(!1),Re([]),pe({}),xe({}),fe({}),_e([]),re({})}catch(s){g({title:"Erro na importa√ß√£o",description:(s==null?void 0:s.message)||"Tente novamente.",variant:"destructive"})}finally{O(!1)}},Mt=(t,a)=>{re(s=>({...s,[t]:a}))},Ft=()=>{const t=[],a={},s={},m={};E.forEach((l,i)=>{const N=ae.some(M=>M.ofxIndex===i),f=Fe[i];if(N&&f==="skip")return;const x=t.length;t.push(l),he[i]!=null&&(a[x]=he[i]),de[i]!=null&&(s[x]=de[i]),me[i]!=null&&(m[x]=me[i])}),Re(t),xe(a),pe(s),fe(m),_e([]),re({}),Me(!1),r(!0)},At=()=>{const t={};ae.forEach(a=>{t[a.ofxIndex]="skip"}),re(t)},Pt=()=>{const t={};ae.forEach(a=>{t[a.ofxIndex]="import"}),re(t)},{filteredInvestments:B,totalInvested:V}=o.useMemo(()=>{let t=[],a,s;if(n.dateRange&&n.dateRange.from){a=n.dateRange.from instanceof Date?n.dateRange.from:new Date(n.dateRange.from);const l=n.dateRange.to||n.dateRange.from;s=l instanceof Date?new Date(l):new Date(l)}else n.periodType==="yearly"&&n.year?(a=ps(new Date(n.year,0,1)),s=hs(new Date(n.year,11,31))):n.periodType==="monthly"&&n.month!==void 0&&n.year&&(a=ie(new Date(n.year,n.month,1)),s=ce(new Date(n.year,n.month,1)));a&&s&&(s=new Date(s),s.setHours(23,59,59,999),t=d.filter(l=>{const i=ue(l.data);return i>=a&&i<=s})),b==="relatorio"&&P&&(t=t.filter(l=>l.descricao.toLowerCase().includes(P.toLowerCase()))),L!=="all"&&(t=t.filter(l=>l.categoria_id===L)),t.sort((l,i)=>{switch(se){case"date-asc":return new Date(l.data)-new Date(i.data);case"date-desc":return new Date(i.data)-new Date(l.data);case"value-asc":return l.valor_aporte-i.valor_aporte;case"value-desc":return i.valor_aporte-l.valor_aporte;case"description":return l.descricao.localeCompare(i.descricao);default:return new Date(i.data)-new Date(l.data)}});const m=t.reduce((l,i)=>l+i.valor_aporte,0);return{filteredInvestments:t,totalInvested:m}},[d,n,P,L,se,b]),Ot=o.useMemo(()=>{if(!(Number(y)||0)||n.periodType!=="monthly")return!1;const a=new Date;return n.year===a.getFullYear()&&n.month===a.getMonth()?V===0:!1},[y,n,V]);o.useMemo(()=>{const t=Number(y)||0;if(!t)return{streak:0,series:[]};const s=Le({start:Te(new Date,11),end:new Date}).map(l=>{const i=ie(l),N=ce(l),f=d.filter(x=>{const M=ue(x.data);return M>=i&&M<=N}).reduce((x,M)=>x+M.valor_aporte,0);return{label:lt(l,"MMM/yy"),invested:f,achieved:f>=t}});let m=0;for(let l=s.length-1;l>=0&&s[l].achieved;l--)m++;return{streak:m,series:s}},[d,y]);const Ye=o.useMemo(()=>{if(B.length===0)return[];const t=X.reduce((a,s)=>(a[s.id]={categoryName:s.nome,total:0},a),{});return B.forEach(a=>{t[a.categoria_id]&&(t[a.categoria_id].total+=a.valor_aporte)}),Object.values(t).filter(a=>a.total>0).sort((a,s)=>s.total-a.total)},[B,X]),Ae=Math.ceil(B.length/Ee),Bt=B.slice((A-1)*Ee,A*Ee),Tt=o.useMemo(()=>{const t=Number(y)||0;return Le({start:Te(new Date,5),end:new Date}).map(s=>{const m=ie(s),l=ce(s),i=d.filter(N=>{const f=ue(N.data);return f>=m&&f<=l}).reduce((N,f)=>N+f.valor_aporte,0);return{label:lt(s,"MMM/yy",{locale:js}),invested:i,achieved:t>0?i>=t:!1}})},[d,y]),Pe=o.useMemo(()=>{if(n.periodType!=="monthly"||n.month===void 0||!n.year)return null;const t=ie(new Date(n.year,n.month,1)),a=ce(new Date(n.year,n.month,1)),s=Te(t,1),m=ie(s),l=ce(s),i=d.filter(f=>{const x=ue(f.data);return x>=t&&x<=a}).reduce((f,x)=>f+x.valor_aporte,0),N=d.filter(f=>{const x=ue(f.data);return x>=m&&x<=l}).reduce((f,x)=>f+x.valor_aporte,0);return N===0?i>0?100:0:(i-N)/N*100},[d,n]),Ue=o.useMemo(()=>{if(n.dateRange&&n.dateRange.from)return Le({start:ie(n.dateRange.from),end:ce(n.dateRange.to||n.dateRange.from)}).length;if(n.periodType==="yearly"&&n.year){const t=new Date;return n.year<t.getFullYear()?12:n.year>t.getFullYear()?0:t.getMonth()+1}return n.periodType==="monthly"&&n.month!==void 0&&n.year,1},[n]),J=o.useMemo(()=>{const t=Number(y)||0;return t>0?t*Ue:0},[y,Ue]),Lt=async(t,a)=>{try{const s=X.find(l=>l.id===t.categoria_id),m={...t,descricao:t.descricao||`Aporte em ${s==null?void 0:s.nome}`};if(a)await C(a,m),g({title:"Aporte atualizado com sucesso!"});else{await S(m),g({title:"Aporte adicionado com sucesso!"});const l=Number(m.valor_aporte)||0,i=10,N=Math.min(40,Math.floor(l/100));D(i+N,"novo_aporte"),F("deposit",{amount:l});const f=V+l,x=J>0&&f>=J;k(x),I({monthlyStreak:void 0}),x&&g({title:"Meta do per√≠odo alcan√ßada! üéØ",description:"Conquista liberada e pontos adicionados."})}v(!1),_(null)}catch(s){g({title:"Erro ao salvar aporte",description:s.message,variant:"destructive"})}},Et=t=>{_({...t,categories:X}),v(!0)},Vt=async t=>{try{await h(t),g({title:"Aporte exclu√≠do com sucesso!"})}catch(a){g({title:"Erro ao excluir aporte",description:a.message,variant:"destructive"})}},qt=t=>{t>0&&t<=Ae&&w(t)},Gt=t=>{t||_(null),v(t)},Oe=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"});return e.jsxs(e.Fragment,{children:[e.jsxs(ts,{children:[e.jsx("title",{children:"Gest√£o de Investimentos - Lumify"}),e.jsx("meta",{name:"description",content:"Acompanhe seus aportes e metas de investimento."})]}),e.jsxs("div",{className:"space-y-4 md:space-y-5 page-top",children:[e.jsx(ms,{title:"Gest√£o de Investimentos",subtitle:"Acompanhe seus aportes e metas de investimento",actionButton:e.jsx(Ss,{onSubmit:Lt,investmentToEdit:R,isOpen:u,onOpenChange:Gt})}),e.jsxs(fs,{value:b,onValueChange:z,className:"w-full",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs(gs,{className:"grid w-full md:w-auto grid-cols-2",children:[e.jsxs(it,{value:"relatorio",className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4"})," Relat√≥rio"]}),e.jsxs(it,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"})," Dashboard"]})]}),e.jsxs("div",{className:"w-full md:w-auto flex items-center gap-2",children:[e.jsx("input",{id:Xe,type:"file",accept:".ofx,.qfx,.ofc,.xml,.txt",className:"hidden",onChange:Rt}),e.jsxs(T,{variant:"outline",onClick:kt,className:"flex items-center gap-2",children:[e.jsx(rs,{className:"h-4 w-4"})," Importar OFX"]}),e.jsx(xs,{periodType:n.periodType,setPeriodType:St,dateRange:n.dateRange,setDateRange:Ct,month:n.month,setMonth:wt,year:n.year,setYear:Dt})]})]}),e.jsx(ct,{value:"relatorio",className:"mt-4 md:mt-5 space-y-4 md:space-y-5",children:e.jsxs(q,{children:[e.jsxs(G,{children:[e.jsx($,{children:"Seus Aportes"}),e.jsx(et,{children:"Lista de todos os aportes no per√≠odo selecionado."})]}),e.jsxs(H,{children:[e.jsx(os,{transactions:Bt,categories:X,accounts:j,type:"investment",onEdit:Et,onDelete:Vt,searchTerm:P,onSearchChange:K,selectedCategory:L,onCategoryChange:le,sortBy:se,onSortChange:Ie}),Ae>1&&e.jsx(ns,{currentPage:A,totalPages:Ae,onPageChange:qt})]})]})}),e.jsxs(ct,{value:"dashboard",className:"mt-4 md:mt-5 space-y-4 md:space-y-5",children:[Ot&&e.jsxs(q,{children:[e.jsx(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsxs($,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(vs,{className:"h-4 w-4 text-warning"}),"Come√ßo de m√™s: ainda sem aportes"]})}),e.jsx(H,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fa√ßa um pequeno aporte agora para manter o ritmo e alcan√ßar sua meta."}),e.jsxs("button",{onClick:()=>v(!0),className:"inline-flex items-center px-3 py-1.5 bg-primary text-white rounded-md hover:opacity-90",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"})," Registrar Aporte"]})]})})]}),e.jsxs("div",{className:"grid gap-3 md:gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(q,{children:[e.jsxs(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Total Aportado"}),e.jsx(tt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(H,{children:[e.jsx("div",{className:"text-2xl font-bold text-income",children:V.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total de aportes no per√≠odo selecionado."})]})]}),e.jsxs(q,{children:[e.jsxs(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"N√∫mero de Aportes"}),e.jsx(Ve,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(H,{children:[e.jsx("div",{className:"text-2xl font-bold",children:B.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Quantidade de aportes realizados."})]})]}),e.jsxs(q,{children:[e.jsxs(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Aporte M√©dio"}),e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(H,{children:[e.jsx("div",{className:"text-2xl font-bold",children:B.length>0?(V/B.length).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}):"R$ 0,00"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Valor m√©dio por aporte."})]})]}),e.jsxs(q,{children:[e.jsxs(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Maior Aporte"}),e.jsx(tt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(H,{children:[e.jsx("div",{className:"text-2xl font-bold",children:B.length>0?Math.max(...B.map(t=>t.valor_aporte)).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}):"R$ 0,00"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Maior aporte do per√≠odo."})]})]}),e.jsxs(q,{children:[e.jsx(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsxs($,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(pt,{className:"h-4 w-4 text-primary"})," Progresso da Meta (per√≠odo)"]})}),e.jsx(H,{children:J>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(V/J*100),"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["R$ ",V.toLocaleString("pt-BR",{minimumFractionDigits:2})," de R$ ",J.toLocaleString("pt-BR",{minimumFractionDigits:2}),V>J&&e.jsxs("span",{className:"block text-green-600 font-medium",children:["R$ ",(V-J).toLocaleString("pt-BR",{minimumFractionDigits:2})," al√©m da meta! üéâ"]})]})]}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"Defina uma meta mensal para acompanhar o progresso."})})]}),Pe!==null&&e.jsxs(q,{children:[e.jsx(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Varia√ß√£o m/m"})}),e.jsxs(H,{children:[e.jsxs("div",{className:`text-2xl font-bold ${Pe>=0?"text-income":"text-expense"}`,children:[Pe.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Comparado ao m√™s anterior."})]})]})]}),e.jsxs(q,{children:[e.jsxs(G,{children:[e.jsx($,{children:"Evolu√ß√£o de Aportes (12 meses)"}),e.jsx(et,{children:"Meses com meta batida ficam destacados."})]}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:Tt.map((t,a)=>e.jsxs("div",{className:`p-3 rounded-md border ${t.achieved?"bg-success-muted border-success":"bg-muted"}`,children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:t.label}),e.jsxs("div",{className:"text-sm font-semibold mt-1",children:["R$ ",t.invested.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),Number(y)>0&&e.jsx("div",{className:`text-xs mt-1 ${t.achieved?"text-success":"text-muted-foreground"}`,children:t.achieved?"Meta batida":"Abaixo da meta"})]},a))})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-4",children:[Ye.length>0?e.jsx(st,{data:Ye,title:"Divis√£o de Aportes por Categoria",description:"An√°lise percentual dos seus investimentos no per√≠odo."}):e.jsx("div",{className:"text-center text-muted-foreground py-12 bg-card border rounded-lg",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-muted rounded-full flex items-center justify-center",children:e.jsx(ye,{className:"w-10 h-10 opacity-50"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold text-lg",children:"Nenhum dado de investimento por categoria."}),e.jsx("p",{className:"text-sm max-w-md",children:"Registre seus aportes para ver a divis√£o por categoria."})]})]})}),j.length>0?e.jsx(st,{data:j.map(t=>({categoryName:t.nome_banco,total:Number(t.saldo)||0})),title:"Patrim√¥nio por Institui√ß√£o",description:"Distribui√ß√£o dos saldos nas suas institui√ß√µes financeiras (incluindo d√≠vidas)"}):e.jsx("div",{className:"text-center text-muted-foreground py-12 bg-card border rounded-lg",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-muted rounded-full flex items-center justify-center",children:e.jsx(ye,{className:"w-10 h-10 opacity-50"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold text-lg",children:"Nenhuma institui√ß√£o registrada."}),e.jsx("p",{className:"text-sm max-w-md",children:"Adicione suas institui√ß√µes financeiras para visualizar a distribui√ß√£o do patrim√¥nio."})]})]})})]})]})]}),e.jsx(be,{open:ke,onOpenChange:r,children:e.jsxs(Ce,{className:"sm:max-w-4xl",children:[e.jsx(we,{children:e.jsx(De,{children:"Importar aportes do OFX"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[E.length," lan√ßamento",E.length!==1?"s":""," de aporte encontrados."]}),e.jsxs("div",{className:"text-sm font-medium",children:["Total a importar:"," ",Oe.format(E.reduce((t,a)=>t+(Number(a.valor)||0),0))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Categoria para os aportes"}),e.jsxs(W,{value:oe||void 0,onValueChange:He,children:[e.jsx(Z,{className:"w-full mt-1",children:e.jsx(ee,{placeholder:"Selecione uma categoria"})}),e.jsx(te,{children:X.map(t=>e.jsx(Y,{value:String(t.id),children:t.nome},t.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Institui√ß√£o financeira"}),e.jsxs(W,{value:ne||void 0,onValueChange:ze,children:[e.jsx(Z,{className:"w-full mt-1",children:e.jsx(ee,{placeholder:"Selecione a institui√ß√£o"})}),e.jsx(te,{children:j.map(t=>e.jsx(Y,{value:String(t.id),children:t.nome_banco},t.id))})]})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Revise as descri√ß√µes, categorias e institui√ß√µes. Valores negativos s√£o tratados como aportes (sa√≠das da conta corrente)."}),e.jsxs("div",{className:"max-h-[60vh] overflow-auto border rounded-md",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-2 text-xs text-muted-foreground border-b",children:[e.jsx("div",{className:"col-span-4",children:"Descri√ß√£o"}),e.jsx("div",{className:"col-span-2",children:"Data"}),e.jsx("div",{className:"col-span-2 text-right",children:"Valor"}),e.jsx("div",{className:"col-span-2",children:"Categoria"}),e.jsx("div",{className:"col-span-2",children:"Institui√ß√£o"})]}),E.map((t,a)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-2 items-center border-b last:border-b-0",children:[e.jsx("div",{className:"col-span-4",children:e.jsx("input",{className:"w-full px-2 py-1 border rounded text-sm",value:he[a]??t.descricao??"Aporte OFX",onChange:s=>xe(m=>({...m,[a]:s.target.value}))})}),e.jsx("div",{className:"col-span-2 text-xs",children:t.data}),e.jsx("div",{className:"col-span-2 text-right font-medium",children:Oe.format(Number(t.valor)||0)}),e.jsx("div",{className:"col-span-2",children:e.jsxs(W,{value:de[a]||oe||void 0,onValueChange:s=>pe(m=>({...m,[a]:s})),children:[e.jsx(Z,{className:"w-full",children:e.jsx(ee,{placeholder:"Categoria"})}),e.jsx(te,{children:X.map(s=>e.jsx(Y,{value:String(s.id),children:s.nome},s.id))})]})}),e.jsx("div",{className:"col-span-2",children:e.jsxs(W,{value:me[a]||ne||void 0,onValueChange:s=>fe(m=>({...m,[a]:s})),children:[e.jsx(Z,{className:"w-full",children:e.jsx(ee,{placeholder:"Institui√ß√£o"})}),e.jsx(te,{children:j.map(s=>e.jsx(Y,{value:String(s.id),children:s.nome_banco},s.id))})]})})]},a))]})]}),e.jsxs(ls,{children:[e.jsx(T,{variant:"ghost",onClick:()=>r(!1),disabled:p,children:"Cancelar"}),e.jsx(T,{onClick:_t,disabled:p,children:p?"Importando...":"Confirmar importa√ß√£o"})]})]})}),e.jsx(be,{open:bt,onOpenChange:Me,children:e.jsxs(Ce,{className:"sm:max-w-4xl",children:[e.jsx(we,{children:e.jsx(De,{children:"Duplicatas encontradas"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Foram encontradas ",ae.length," transa√ß√£o(√µes) que podem ser duplicatas de aportes j√° cadastrados. Voc√™ pode escolher importar ou ignorar cada uma delas."]}),e.jsxs("div",{className:"max-h-[50vh] overflow-auto border rounded-md",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-2 text-xs text-muted-foreground border-b",children:[e.jsx("div",{className:"col-span-3",children:"Descri√ß√£o"}),e.jsx("div",{className:"col-span-2",children:"Data"}),e.jsx("div",{className:"col-span-2 text-right",children:"Valor"}),e.jsx("div",{className:"col-span-3",children:"Aporte existente"}),e.jsx("div",{className:"col-span-2",children:"A√ß√£o"})]}),ae.map(t=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-2 items-center border-b last:border-b-0",children:[e.jsx("div",{className:"col-span-3 text-sm",children:t.ofxTransaction.descricao}),e.jsx("div",{className:"col-span-2 text-xs",children:t.ofxTransaction.data}),e.jsx("div",{className:"col-span-2 text-right font-medium",children:Oe.format(Number(t.ofxTransaction.valor)||0)}),e.jsx("div",{className:"col-span-3 text-xs text-muted-foreground",children:t.existingInvestment.descricao}),e.jsx("div",{className:"col-span-2",children:e.jsxs(W,{value:Fe[t.ofxIndex]||void 0,onValueChange:a=>Mt(t.ofxIndex,a),children:[e.jsx(Z,{className:"w-full",children:e.jsx(ee,{placeholder:"Escolher"})}),e.jsxs(te,{children:[e.jsx(Y,{value:"import",children:"Importar"}),e.jsx(Y,{value:"skip",children:"Ignorar"})]})]})})]},t.ofxIndex))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:"outline",onClick:At,children:"Ignorar todas"}),e.jsx(T,{variant:"outline",onClick:Pt,children:"Importar todas"}),e.jsx(T,{onClick:Ft,children:"Prosseguir"})]})]})]})})]})]})}export{Zs as InvestmentsPage};
