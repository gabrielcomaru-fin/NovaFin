import{g as at,f as rt,r as l,j as e,B as w,k as Te,T as ot,h as Rt,H as Ft,n as fe,C as S,a as I,b as R,d as Ue,e as F,D as Ee}from"./index-9965e3b2.js";import{u as Mt,L as _t,U as At,T as Ot,P as kt,p as Bt}from"./ofx-d2254005.js";import{C as Qe}from"./CategoryChart-28334052.js";import{L as J,I as We,C as Je}from"./label-0e5b703b.js";import{S as T,a as V,b as $,c as G,d as O}from"./select-c0176194.js";import{D as je,a as Ke,P as Pt,b as ve,c as Ne,d as ye,e as Ze,f as Lt}from"./dialog-dd410bbf.js";import{B as Tt}from"./badge-3c3656a1.js";import{s as Vt,e as $t,C as Gt,a as qt}from"./CompactHeader-3b1ef90b.js";import{T as Yt,a as zt,b as et,c as tt}from"./tabs-f9446dda.js";import{s as K,e as Z,p as oe,a as Be}from"./index-a49341d7.js";import{e as Pe}from"./index-9eaf3fc2.js";import{f as st}from"./index-65722b09.js";import{p as Ht}from"./index-23bf3cd3.js";import{A as Xt}from"./alert-circle-28e9bdf7.js";import"./trash-2-f6a5397d.js";import"./wallet-64bfd254.js";import"./building-2-ac075960.js";import"./generateCategoricalChart-c617fb56.js";import"./index-a53a69e9.js";function Ut({onSubmit:v,investmentToEdit:d,onOpenChange:M,isOpen:ee}){const{investmentGoal:q,handleSetInvestmentGoal:be,categories:y,accounts:g}=at(),{toast:Y}=rt(),ne=y.filter(r=>r.tipo==="investimento"),k={descricao:"",valor_aporte:"",categoria_id:"",instituicao_id:"",data:new Date().toISOString().split("T")[0]},we={goal:""},[h,f]=l.useState(k),[te,z]=l.useState(we),[H,se]=l.useState(!1),B=l.useRef(null),ie=l.useRef(null),_=r=>{if(r==null||r==="")return"";const m=Number(r);return isNaN(m)?"":m.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})};l.useEffect(()=>{var r,m;d!=null&&d.id?f({descricao:d.descricao||"",valor_aporte:_(d.valor_aporte),categoria_id:((r=d.categoria_id)==null?void 0:r.toString())||"",instituicao_id:((m=d.instituicao_id)==null?void 0:m.toString())||"",data:d.data?new Date(d.data).toISOString().split("T")[0]:k.data}):f(k)},[d,ee]),l.useEffect(()=>{z({goal:_(q)})},[q,H]),l.useEffect(()=>{var m;const r=(m=B.current)==null?void 0:m.input;if(r){const N=r.value.length;r.setSelectionRange(N,N)}},[h.valor_aporte]),l.useEffect(()=>{var m;const r=(m=ie.current)==null?void 0:m.input;if(r){const N=r.value.length;r.setSelectionRange(N,N)}},[te.goal]);const le=r=>{if(typeof r=="number")return r;if(!r)return 0;const m=String(r).replace(/\./g,"").replace(",","."),N=parseFloat(m);return isNaN(N)?0:N},P=r=>{r.preventDefault();const m=le(h.valor_aporte);if(m<=0){Y({title:"Erro",description:"Informe um valor de aporte v√°lido maior que zero.",variant:"destructive"});return}v({...h,valor_aporte:m},d==null?void 0:d.id),f(k)},De=r=>{M(r),r||f(k)},X=(r,m)=>{f({...h,[m]:r})},Ce=r=>{z({goal:r})},Se=async r=>{r.preventDefault();const m=le(te.goal);if(isNaN(m)||m<0){Y({title:"Erro",description:"Defina um valor v√°lido para a meta.",variant:"destructive"});return}try{await be(m)}catch{Y({title:"Erro",description:"N√£o foi poss√≠vel salvar a meta.",variant:"destructive"});return}Y({title:"Meta atualizada!",description:`Nova meta mensal: R$ ${m.toLocaleString("pt-BR",{minimumFractionDigits:2})}`}),se(!1)};return e.jsxs("div",{className:"flex items-center gap-2",children:[Number(q)>0&&e.jsxs(Tt,{variant:"secondary",children:["Meta atual: R$ ",Number(q).toLocaleString("pt-BR",{minimumFractionDigits:2}),"/m√™s"]}),e.jsxs(je,{open:ee,onOpenChange:De,children:[!(d!=null&&d.id)&&e.jsx(Ke,{asChild:!0,children:e.jsxs(w,{children:[e.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Novo Aporte"]})}),e.jsxs(ve,{children:[e.jsxs(Ne,{children:[e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5 text-primary"}),d!=null&&d.id?"Editar Aporte":"Registrar Investimento"]}),e.jsx(Ze,{children:d!=null&&d.id?"Atualize os detalhes do seu aporte.":"Adicione um novo aporte para seus investimentos."})]}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"description",children:"Descri√ß√£o (Opcional)"}),e.jsx(We,{id:"description",placeholder:"Ex: Aporte mensal",value:h.descricao,onChange:r=>f({...h,descricao:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"amount",children:"Valor do Aporte (R$)"}),e.jsx(Je,{id:"amount",placeholder:"0,00",value:h.valor_aporte,onChange:r=>X(r,"valor_aporte"),ref:B,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"date",children:"Data"}),e.jsx(We,{id:"date",type:"date",value:h.data,onChange:r=>f({...h,data:r.target.value}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"category",children:"Categoria"}),ne.length>0?e.jsxs(T,{value:h.categoria_id,onValueChange:r=>f({...h,categoria_id:r}),required:!0,children:[e.jsx(V,{children:e.jsx($,{placeholder:"Selecione uma categoria"})}),e.jsx(G,{children:ne.map(r=>e.jsx(O,{value:r.id.toString(),children:r.nome},r.id))})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma categoria de investimento dispon√≠vel."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"institution",children:"Institui√ß√£o Financeira"}),g.length>0?e.jsxs(T,{value:h.instituicao_id,onValueChange:r=>f({...h,instituicao_id:r}),required:!0,children:[e.jsx(V,{children:e.jsx($,{placeholder:"Selecione uma institui√ß√£o"})}),e.jsx(G,{children:g.map(r=>e.jsx(O,{value:r.id.toString(),children:r.nome_banco},r.id))})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma institui√ß√£o financeira dispon√≠vel."})]})]}),e.jsx(w,{type:"submit",className:"w-full",children:d!=null&&d.id?"Salvar Altera√ß√µes":"Registrar Aporte"})]})]})]}),e.jsxs(je,{open:H,onOpenChange:se,children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(w,{variant:"outline",children:[e.jsx(ot,{className:"w-4 h-4 mr-2"}),"Definir Meta"]})}),e.jsxs(ve,{children:[e.jsxs(Ne,{children:[e.jsx(ye,{children:"Definir Meta de Aportes"}),e.jsx(Ze,{children:"Defina sua meta mensal de investimentos para acompanhar seu progresso."})]}),e.jsxs("form",{onSubmit:Se,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"goalAmount",children:"Meta Mensal (R$)"}),e.jsx(Je,{id:"goalAmount",placeholder:"0,00",value:te.goal,onChange:Ce,ref:ie,required:!0})]}),e.jsx(w,{type:"submit",className:"w-full",children:"Definir Meta"})]})]})]})]})}const Le=10,Et="investmentsPage";function xs(){var ze,He;const{investments:v,categories:d,accounts:M,addInvestment:ee,updateInvestment:q,deleteInvestment:be,investmentGoal:y}=at(),{toast:g}=rt(),{addPoints:Y,registerAction:ne,evaluateAchievements:k,setMetaMonthHit:we}=Rt(),[h,f]=l.useState(!1),[te,z]=l.useState(null),[H,se]=l.useState(1),[B,ie]=l.useState("relatorio"),[_,le]=l.useState(""),[P,De]=l.useState("all"),[X,Ce]=l.useState("date-desc"),[Se,r]=l.useState(!1),[m,N]=l.useState(!1),[D,Ie]=l.useState([]),[ae,ce]=l.useState({}),[de,me]=l.useState({}),[re,ue]=l.useState({}),[U,Re]=l.useState([]),[nt,Fe]=l.useState(!1),[Me,E]=l.useState({}),A=l.useMemo(()=>d.filter(t=>t.tipo==="investimento"),[d]),pe=((ze=A[0])==null?void 0:ze.id)||"",xe=((He=M[0])==null?void 0:He.id)||"",[Q,Ve]=l.useState(pe),[W,$e]=l.useState(xe),Ge="ofx-investments-file-input",[n,he]=Mt(`filter_${Et}`,()=>({periodType:"monthly",dateRange:void 0,month:new Date().getMonth(),year:new Date().getFullYear()})),it=t=>{he({...n,dateRange:t})},lt=t=>{he({dateRange:void 0,periodType:"monthly",month:t,year:n.year||new Date().getFullYear()})},ct=t=>{he(a=>({...a,dateRange:void 0,year:t}))},dt=t=>{he(a=>({...a,periodType:t,dateRange:void 0}))};l.useEffect(()=>{se(1)},[_,P,X,n,B]),l.useEffect(()=>{!Q&&pe&&Ve(pe)},[pe,Q]),l.useEffect(()=>{!W&&xe&&$e(xe)},[xe,W]);const mt=t=>{const a=[];return t.forEach((s,c)=>{var u;const i=s.data,o=((u=s.descricao)==null?void 0:u.toLowerCase().trim())||"",x=Number(s.valor)||0,p=v.find(j=>{var Xe;const ke=j.data,ge=((Xe=j.descricao)==null?void 0:Xe.toLowerCase().trim())||"",It=Number(j.valor_aporte)||0;return ke===i&&ge===o&&Math.abs(It-x)<.01});p&&a.push({ofxIndex:c,ofxTransaction:s,existingInvestment:p})}),a},ut=()=>{const t=document.getElementById(Ge);t&&t.click()},pt=async t=>{const a=t.target.files&&t.target.files[0];if(a)try{const c=(await Bt(a)).filter(o=>o.valor<0||String(o.tipo).toUpperCase()==="DEBIT").map(o=>({...o,valor:Math.abs(o.valor)}));if(c.length===0){g({title:"Nenhum aporte encontrado no OFX",description:"Verifique se o arquivo cont√©m lan√ßamentos de sa√≠da relacionados a investimentos.",variant:"destructive"}),t.target.value="";return}const i=mt(c);Re(i),E({}),Ie(c),ce({}),me(c.reduce((o,x,p)=>(o[p]=x.descricao||"Aporte OFX",o),{})),ue({}),i.length>0?Fe(!0):r(!0)}catch(s){g({title:"Falha ao ler OFX",description:(s==null?void 0:s.message)||"Formato inv√°lido.",variant:"destructive"})}finally{t.target.value=""}},xt=async()=>{const t=D.some((s,c)=>ae[c])||!!Q,a=D.some((s,c)=>re[c])||!!W;if(!t||!a){g({title:"Selecione categoria e institui√ß√£o",description:"Defina ao menos a categoria e a institui√ß√£o padr√£o ou por item.",variant:"destructive"});return}N(!0);try{let s=0,c=0;for(let o=0;o<D.length;o++){const x=D[o];if(U.find(ge=>ge.ofxIndex===o)&&Me[o]==="skip"){c++;continue}const u=ae[o]||Q,j=re[o]||W;if(!u||!j)continue;const ke={descricao:de[o]??x.descricao??"Aporte OFX",valor_aporte:Number(x.valor)||0,categoria_id:u,instituicao_id:j,data:x.data||new Date().toISOString().split("T")[0]};try{await ee(ke),s++}catch{}}let i=`${s} aportes adicionados`;c>0&&(i+=`, ${c} duplicatas ignoradas`),g({title:"Importa√ß√£o conclu√≠da",description:i}),r(!1),Ie([]),ce({}),me({}),ue({}),Re([]),E({})}catch(s){g({title:"Erro na importa√ß√£o",description:(s==null?void 0:s.message)||"Tente novamente.",variant:"destructive"})}finally{N(!1)}},ht=(t,a)=>{E(s=>({...s,[t]:a}))},gt=()=>{const t=[],a={},s={},c={};D.forEach((i,o)=>{const x=U.some(j=>j.ofxIndex===o),p=Me[o];if(x&&p==="skip")return;const u=t.length;t.push(i),de[o]!=null&&(a[u]=de[o]),ae[o]!=null&&(s[u]=ae[o]),re[o]!=null&&(c[u]=re[o])}),Ie(t),me(a),ce(s),ue(c),Re([]),E({}),Fe(!1),r(!0)},ft=()=>{const t={};U.forEach(a=>{t[a.ofxIndex]="skip"}),E(t)},jt=()=>{const t={};U.forEach(a=>{t[a.ofxIndex]="import"}),E(t)},{filteredInvestments:b,totalInvested:C}=l.useMemo(()=>{let t=[],a,s;n.dateRange&&n.dateRange.from?(a=n.dateRange.from,s=n.dateRange.to||n.dateRange.from):n.periodType==="yearly"&&n.year?(a=Vt(new Date(n.year,0,1)),s=$t(new Date(n.year,11,31))):n.periodType==="monthly"&&n.month!==void 0&&n.year&&(a=K(new Date(n.year,n.month,1)),s=Z(new Date(n.year,n.month,1))),a&&s&&(s.setHours(23,59,59,999),t=v.filter(i=>{const o=oe(i.data);return o>=a&&o<=s})),B==="relatorio"&&_&&(t=t.filter(i=>i.descricao.toLowerCase().includes(_.toLowerCase()))),P!=="all"&&(t=t.filter(i=>i.categoria_id===P)),t.sort((i,o)=>{switch(X){case"date-asc":return new Date(i.data)-new Date(o.data);case"date-desc":return new Date(o.data)-new Date(i.data);case"value-asc":return i.valor_aporte-o.valor_aporte;case"value-desc":return o.valor_aporte-i.valor_aporte;case"description":return i.descricao.localeCompare(o.descricao);default:return new Date(o.data)-new Date(i.data)}});const c=t.reduce((i,o)=>i+o.valor_aporte,0);return{filteredInvestments:t,totalInvested:c}},[v,n,_,P,X,B]),vt=l.useMemo(()=>{if(!(Number(y)||0)||n.periodType!=="monthly")return!1;const a=new Date;return n.year===a.getFullYear()&&n.month===a.getMonth()?C===0:!1},[y,n,C]);l.useMemo(()=>{const t=Number(y)||0;if(!t)return{streak:0,series:[]};const s=Pe({start:Be(new Date,11),end:new Date}).map(i=>{const o=K(i),x=Z(i),p=v.filter(u=>{const j=oe(u.data);return j>=o&&j<=x}).reduce((u,j)=>u+j.valor_aporte,0);return{label:st(i,"MMM/yy"),invested:p,achieved:p>=t}});let c=0;for(let i=s.length-1;i>=0&&s[i].achieved;i--)c++;return{streak:c,series:s}},[v,y]);const qe=l.useMemo(()=>{if(b.length===0)return[];const t=A.reduce((a,s)=>(a[s.id]={categoryName:s.nome,total:0},a),{});return b.forEach(a=>{t[a.categoria_id]&&(t[a.categoria_id].total+=a.valor_aporte)}),Object.values(t).filter(a=>a.total>0).sort((a,s)=>s.total-a.total)},[b,A]),_e=Math.ceil(b.length/Le),Nt=b.slice((H-1)*Le,H*Le),yt=l.useMemo(()=>{const t=Number(y)||0;return Pe({start:Be(new Date,5),end:new Date}).map(s=>{const c=K(s),i=Z(s),o=v.filter(x=>{const p=oe(x.data);return p>=c&&p<=i}).reduce((x,p)=>x+p.valor_aporte,0);return{label:st(s,"MMM/yy",{locale:Ht}),invested:o,achieved:t>0?o>=t:!1}})},[v,y]),Ae=l.useMemo(()=>{if(n.periodType!=="monthly"||n.month===void 0||!n.year)return null;const t=K(new Date(n.year,n.month,1)),a=Z(new Date(n.year,n.month,1)),s=Be(t,1),c=K(s),i=Z(s),o=v.filter(p=>{const u=oe(p.data);return u>=t&&u<=a}).reduce((p,u)=>p+u.valor_aporte,0),x=v.filter(p=>{const u=oe(p.data);return u>=c&&u<=i}).reduce((p,u)=>p+u.valor_aporte,0);return x===0?o>0?100:0:(o-x)/x*100},[v,n]),Ye=l.useMemo(()=>{if(n.dateRange&&n.dateRange.from)return Pe({start:K(n.dateRange.from),end:Z(n.dateRange.to||n.dateRange.from)}).length;if(n.periodType==="yearly"&&n.year){const t=new Date;return n.year<t.getFullYear()?12:n.year>t.getFullYear()?0:t.getMonth()+1}return n.periodType==="monthly"&&n.month!==void 0&&n.year,1},[n]),L=l.useMemo(()=>{const t=Number(y)||0;return t>0?t*Ye:0},[y,Ye]),bt=async(t,a)=>{try{const s=A.find(i=>i.id===t.categoria_id),c={...t,descricao:t.descricao||`Aporte em ${s==null?void 0:s.nome}`};if(a)await q(a,c),g({title:"Aporte atualizado com sucesso!"});else{await ee(c),g({title:"Aporte adicionado com sucesso!"});const i=Number(c.valor_aporte)||0,o=10,x=Math.min(40,Math.floor(i/100));Y(o+x,"novo_aporte"),ne("deposit",{amount:i});const p=C+i,u=L>0&&p>=L;we(u),k({monthlyStreak:void 0}),u&&g({title:"Meta do per√≠odo alcan√ßada! üéØ",description:"Conquista liberada e pontos adicionados."})}f(!1),z(null)}catch(s){g({title:"Erro ao salvar aporte",description:s.message,variant:"destructive"})}},wt=t=>{z({...t,categories:A}),f(!0)},Dt=async t=>{try{await be(t),g({title:"Aporte exclu√≠do com sucesso!"})}catch(a){g({title:"Erro ao excluir aporte",description:a.message,variant:"destructive"})}},Ct=t=>{t>0&&t<=_e&&se(t)},St=t=>{t||z(null),f(t)},Oe=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"});return e.jsxs(e.Fragment,{children:[e.jsxs(Ft,{children:[e.jsx("title",{children:"Gest√£o de Investimentos - Lumify"}),e.jsx("meta",{name:"description",content:"Acompanhe seus aportes e metas de investimento."})]}),e.jsxs("div",{className:"space-y-4 md:space-y-5 page-top",children:[e.jsx(Gt,{title:"Gest√£o de Investimentos",subtitle:"Acompanhe seus aportes e metas de investimento",actionButton:e.jsx(Ut,{onSubmit:bt,investmentToEdit:te,isOpen:h,onOpenChange:St})}),e.jsxs(Yt,{value:B,onValueChange:ie,className:"w-full",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs(zt,{className:"grid w-full md:w-auto grid-cols-2",children:[e.jsxs(et,{value:"relatorio",className:"flex items-center gap-2",children:[e.jsx(_t,{className:"h-4 w-4"})," Relat√≥rio"]}),e.jsxs(et,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"})," Dashboard"]})]}),e.jsxs("div",{className:"w-full md:w-auto flex items-center gap-2",children:[e.jsx("input",{id:Ge,type:"file",accept:".ofx,.qfx,.ofc,.xml,.txt",className:"hidden",onChange:pt}),e.jsxs(w,{variant:"outline",onClick:ut,className:"flex items-center gap-2",children:[e.jsx(At,{className:"h-4 w-4"})," Importar OFX"]}),e.jsx(qt,{periodType:n.periodType,setPeriodType:dt,dateRange:n.dateRange,setDateRange:it,month:n.month,setMonth:lt,year:n.year,setYear:ct})]})]}),e.jsx(tt,{value:"relatorio",className:"mt-4 md:mt-5 space-y-4 md:space-y-5",children:e.jsxs(S,{children:[e.jsxs(I,{children:[e.jsx(R,{children:"Seus Aportes"}),e.jsx(Ue,{children:"Lista de todos os aportes no per√≠odo selecionado."})]}),e.jsxs(F,{children:[e.jsx(Ot,{transactions:Nt,categories:A,accounts:M,type:"investment",onEdit:wt,onDelete:Dt,searchTerm:_,onSearchChange:le,selectedCategory:P,onCategoryChange:De,sortBy:X,onSortChange:Ce}),_e>1&&e.jsx(kt,{currentPage:H,totalPages:_e,onPageChange:Ct})]})]})}),e.jsxs(tt,{value:"dashboard",className:"mt-4 md:mt-5 space-y-4 md:space-y-5",children:[vt&&e.jsxs(S,{children:[e.jsx(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Xt,{className:"h-4 w-4 text-warning"}),"Come√ßo de m√™s: ainda sem aportes"]})}),e.jsx(F,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fa√ßa um pequeno aporte agora para manter o ritmo e alcan√ßar sua meta."}),e.jsxs("button",{onClick:()=>f(!0),className:"inline-flex items-center px-3 py-1.5 bg-primary text-white rounded-md hover:opacity-90",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"})," Registrar Aporte"]})]})})]}),e.jsxs("div",{className:"grid gap-3 md:gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(S,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Total Aportado"}),e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(F,{children:[e.jsx("div",{className:"text-2xl font-bold text-income",children:C.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total de aportes no per√≠odo selecionado."})]})]}),e.jsxs(S,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"N√∫mero de Aportes"}),e.jsx(Te,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(F,{children:[e.jsx("div",{className:"text-2xl font-bold",children:b.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Quantidade de aportes realizados."})]})]}),e.jsxs(S,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Aporte M√©dio"}),e.jsx(fe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(F,{children:[e.jsx("div",{className:"text-2xl font-bold",children:b.length>0?(C/b.length).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}):"R$ 0,00"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Valor m√©dio por aporte."})]})]}),e.jsxs(S,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Maior Aporte"}),e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(F,{children:[e.jsx("div",{className:"text-2xl font-bold",children:b.length>0?Math.max(...b.map(t=>t.valor_aporte)).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}):"R$ 0,00"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Maior aporte do per√≠odo."})]})]}),e.jsxs(S,{children:[e.jsx(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ot,{className:"h-4 w-4 text-primary"})," Progresso da Meta (per√≠odo)"]})}),e.jsx(F,{children:L>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(C/L*100),"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["R$ ",C.toLocaleString("pt-BR",{minimumFractionDigits:2})," de R$ ",L.toLocaleString("pt-BR",{minimumFractionDigits:2}),C>L&&e.jsxs("span",{className:"block text-green-600 font-medium",children:["R$ ",(C-L).toLocaleString("pt-BR",{minimumFractionDigits:2})," al√©m da meta! üéâ"]})]})]}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"Defina uma meta mensal para acompanhar o progresso."})})]}),Ae!==null&&e.jsxs(S,{children:[e.jsx(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(R,{className:"text-sm font-medium",children:"Varia√ß√£o m/m"})}),e.jsxs(F,{children:[e.jsxs("div",{className:`text-2xl font-bold ${Ae>=0?"text-income":"text-expense"}`,children:[Ae.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Comparado ao m√™s anterior."})]})]})]}),e.jsxs(S,{children:[e.jsxs(I,{children:[e.jsx(R,{children:"Evolu√ß√£o de Aportes (12 meses)"}),e.jsx(Ue,{children:"Meses com meta batida ficam destacados."})]}),e.jsx(F,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:yt.map((t,a)=>e.jsxs("div",{className:`p-3 rounded-md border ${t.achieved?"bg-success-muted border-success":"bg-muted"}`,children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:t.label}),e.jsxs("div",{className:"text-sm font-semibold mt-1",children:["R$ ",t.invested.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),Number(y)>0&&e.jsx("div",{className:`text-xs mt-1 ${t.achieved?"text-success":"text-muted-foreground"}`,children:t.achieved?"Meta batida":"Abaixo da meta"})]},a))})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-4",children:[qe.length>0?e.jsx(Qe,{data:qe,title:"Divis√£o de Aportes por Categoria",description:"An√°lise percentual dos seus investimentos no per√≠odo."}):e.jsx("div",{className:"text-center text-muted-foreground py-12 bg-card border rounded-lg",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-muted rounded-full flex items-center justify-center",children:e.jsx(fe,{className:"w-10 h-10 opacity-50"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold text-lg",children:"Nenhum dado de investimento por categoria."}),e.jsx("p",{className:"text-sm max-w-md",children:"Registre seus aportes para ver a divis√£o por categoria."})]})]})}),M.length>0?e.jsx(Qe,{data:M.map(t=>({categoryName:t.nome_banco,total:Number(t.saldo)||0})),title:"Patrim√¥nio por Institui√ß√£o",description:"Distribui√ß√£o dos saldos nas suas institui√ß√µes financeiras (incluindo d√≠vidas)"}):e.jsx("div",{className:"text-center text-muted-foreground py-12 bg-card border rounded-lg",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-muted rounded-full flex items-center justify-center",children:e.jsx(fe,{className:"w-10 h-10 opacity-50"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold text-lg",children:"Nenhuma institui√ß√£o registrada."}),e.jsx("p",{className:"text-sm max-w-md",children:"Adicione suas institui√ß√µes financeiras para visualizar a distribui√ß√£o do patrim√¥nio."})]})]})})]})]})]}),e.jsx(je,{open:Se,onOpenChange:r,children:e.jsxs(ve,{className:"sm:max-w-4xl",children:[e.jsx(Ne,{children:e.jsx(ye,{children:"Importar aportes do OFX"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[D.length," lan√ßamento",D.length!==1?"s":""," de aporte encontrados."]}),e.jsxs("div",{className:"text-sm font-medium",children:["Total a importar:"," ",Oe.format(D.reduce((t,a)=>t+(Number(a.valor)||0),0))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Categoria para os aportes"}),e.jsxs(T,{value:Q||void 0,onValueChange:Ve,children:[e.jsx(V,{className:"w-full mt-1",children:e.jsx($,{placeholder:"Selecione uma categoria"})}),e.jsx(G,{children:A.map(t=>e.jsx(O,{value:String(t.id),children:t.nome},t.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Institui√ß√£o financeira"}),e.jsxs(T,{value:W||void 0,onValueChange:$e,children:[e.jsx(V,{className:"w-full mt-1",children:e.jsx($,{placeholder:"Selecione a institui√ß√£o"})}),e.jsx(G,{children:M.map(t=>e.jsx(O,{value:String(t.id),children:t.nome_banco},t.id))})]})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Revise as descri√ß√µes, categorias e institui√ß√µes. Valores negativos s√£o tratados como aportes (sa√≠das da conta corrente)."}),e.jsxs("div",{className:"max-h-[60vh] overflow-auto border rounded-md",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-2 text-xs text-muted-foreground border-b",children:[e.jsx("div",{className:"col-span-4",children:"Descri√ß√£o"}),e.jsx("div",{className:"col-span-2",children:"Data"}),e.jsx("div",{className:"col-span-2 text-right",children:"Valor"}),e.jsx("div",{className:"col-span-2",children:"Categoria"}),e.jsx("div",{className:"col-span-2",children:"Institui√ß√£o"})]}),D.map((t,a)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-2 items-center border-b last:border-b-0",children:[e.jsx("div",{className:"col-span-4",children:e.jsx("input",{className:"w-full px-2 py-1 border rounded text-sm",value:de[a]??t.descricao??"Aporte OFX",onChange:s=>me(c=>({...c,[a]:s.target.value}))})}),e.jsx("div",{className:"col-span-2 text-xs",children:t.data}),e.jsx("div",{className:"col-span-2 text-right font-medium",children:Oe.format(Number(t.valor)||0)}),e.jsx("div",{className:"col-span-2",children:e.jsxs(T,{value:ae[a]||Q||void 0,onValueChange:s=>ce(c=>({...c,[a]:s})),children:[e.jsx(V,{className:"w-full",children:e.jsx($,{placeholder:"Categoria"})}),e.jsx(G,{children:A.map(s=>e.jsx(O,{value:String(s.id),children:s.nome},s.id))})]})}),e.jsx("div",{className:"col-span-2",children:e.jsxs(T,{value:re[a]||W||void 0,onValueChange:s=>ue(c=>({...c,[a]:s})),children:[e.jsx(V,{className:"w-full",children:e.jsx($,{placeholder:"Institui√ß√£o"})}),e.jsx(G,{children:M.map(s=>e.jsx(O,{value:String(s.id),children:s.nome_banco},s.id))})]})})]},a))]})]}),e.jsxs(Lt,{children:[e.jsx(w,{variant:"ghost",onClick:()=>r(!1),disabled:m,children:"Cancelar"}),e.jsx(w,{onClick:xt,disabled:m,children:m?"Importando...":"Confirmar importa√ß√£o"})]})]})}),e.jsx(je,{open:nt,onOpenChange:Fe,children:e.jsxs(ve,{className:"sm:max-w-4xl",children:[e.jsx(Ne,{children:e.jsx(ye,{children:"Duplicatas encontradas"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Foram encontradas ",U.length," transa√ß√£o(√µes) que podem ser duplicatas de aportes j√° cadastrados. Voc√™ pode escolher importar ou ignorar cada uma delas."]}),e.jsxs("div",{className:"max-h-[50vh] overflow-auto border rounded-md",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-2 text-xs text-muted-foreground border-b",children:[e.jsx("div",{className:"col-span-3",children:"Descri√ß√£o"}),e.jsx("div",{className:"col-span-2",children:"Data"}),e.jsx("div",{className:"col-span-2 text-right",children:"Valor"}),e.jsx("div",{className:"col-span-3",children:"Aporte existente"}),e.jsx("div",{className:"col-span-2",children:"A√ß√£o"})]}),U.map(t=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-2 items-center border-b last:border-b-0",children:[e.jsx("div",{className:"col-span-3 text-sm",children:t.ofxTransaction.descricao}),e.jsx("div",{className:"col-span-2 text-xs",children:t.ofxTransaction.data}),e.jsx("div",{className:"col-span-2 text-right font-medium",children:Oe.format(Number(t.ofxTransaction.valor)||0)}),e.jsx("div",{className:"col-span-3 text-xs text-muted-foreground",children:t.existingInvestment.descricao}),e.jsx("div",{className:"col-span-2",children:e.jsxs(T,{value:Me[t.ofxIndex]||void 0,onValueChange:a=>ht(t.ofxIndex,a),children:[e.jsx(V,{className:"w-full",children:e.jsx($,{placeholder:"Escolher"})}),e.jsxs(G,{children:[e.jsx(O,{value:"import",children:"Importar"}),e.jsx(O,{value:"skip",children:"Ignorar"})]})]})})]},t.ofxIndex))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{variant:"outline",onClick:ft,children:"Ignorar todas"}),e.jsx(w,{variant:"outline",onClick:jt,children:"Importar todas"}),e.jsx(w,{onClick:gt,children:"Prosseguir"})]})]})]})})]})]})}export{xs as InvestmentsPage};
