import{r as i,j as e,B as X,D as E,g as we,f as Ne,H as De,n as $,C as S,a as b,b as I,d as Ce,e as F,k as G}from"./index-9965e3b2.js";import{u as Re,L as Se,U as be,T as Ie,P as Fe}from"./ofx-d2254005.js";import{L as U,I as Q,C as Oe}from"./label-0e5b703b.js";import{D as Me,a as Pe,P as Le,b as ke,c as Be,d as Ae,e as He}from"./dialog-dd410bbf.js";import{s as Ve,e as Ye,C as Ue,a as qe}from"./CompactHeader-3b1ef90b.js";import"./select-c0176194.js";import{b as w,O as ze}from"./index-4e6d4bd5.js";import{T as Xe,a as _e,b as J,c as K}from"./tabs-f9446dda.js";import{f as q}from"./format-36791d56.js";import{s as T,e as W,p as Z,a as $e}from"./index-a49341d7.js";import"./badge-3c3656a1.js";import"./trash-2-f6a5397d.js";import"./wallet-64bfd254.js";import"./building-2-ac075960.js";import"./index-a53a69e9.js";import"./index-65722b09.js";import"./progress-3f92366f.js";function Ge({onSubmit:N,incomeToEdit:s,onOpenChange:k,isOpen:D}){const h={descricao:"",valor:"",data:new Date().toISOString().split("T")[0]},[c,u]=i.useState(h),[x,j]=i.useState(""),y=i.useRef(null),B=r=>{if(r==null||r==="")return"";const d=Number(r);return isNaN(d)?"":d.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})};i.useEffect(()=>{s!=null&&s.id?u({descricao:s.descricao||"",valor:B(s.valor),data:s.data?new Date(s.data).toISOString().split("T")[0]:h.data}):u(h),j("")},[s,D]),i.useEffect(()=>{var d;const r=(d=y.current)==null?void 0:d.input;if(r){const g=r.value.length;r.setSelectionRange(g,g)}},[c.valor]);const C=r=>{if(!r)return 0;const d=String(r).replace(/\./g,"").replace(",","."),g=parseFloat(d);return isNaN(g)?0:g},R=r=>{r.preventDefault();const d=C(c.valor);if(d<=0){j("Informe um valor válido maior que zero.");return}if(!c.descricao.trim()||c.descricao.trim().length<3){j("Descrição deve ter pelo menos 3 caracteres.");return}N({...c,valor:d},s==null?void 0:s.id),O()},O=()=>{u(h),j("")},v=r=>{k(r),r||O()},A=r=>{u({...c,valor:r})};return e.jsxs(Me,{open:D,onOpenChange:v,children:[!(s!=null&&s.id)&&e.jsx(Pe,{asChild:!0,children:e.jsxs(X,{children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Nova Receita"]})}),e.jsxs(ke,{className:"sm:max-w-md",children:[e.jsxs(Be,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),s!=null&&s.id?"Editar Receita":"Adicionar Receita"]}),e.jsx(He,{children:s!=null&&s.id?"Atualize os detalhes da sua receita.":"Registre uma nova receita para controlar suas entradas financeiras."})]}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"description",children:"Descrição"}),e.jsx(Q,{id:"description",placeholder:"Ex: Salário mensal, Freelance, Venda",value:c.descricao,onChange:r=>u({...c,descricao:r.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"amount",children:"Valor (R$)"}),e.jsx(Oe,{id:"amount",placeholder:"0,00",value:c.valor,onChange:A,ref:y,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"date",children:"Data"}),e.jsx(Q,{id:"date",type:"date",value:c.data,onChange:r=>u({...c,data:r.target.value}),required:!0})]})]}),x&&e.jsx("p",{className:"text-sm text-red-600",children:x}),e.jsx(X,{type:"submit",className:"w-full",children:s!=null&&s.id?"Salvar Alterações":"Adicionar Receita"})]})]})]})}const z=10,Qe="incomesPage";function ma(){const{incomes:N,addIncome:s,updateIncome:k,deleteIncome:D,categories:h,accounts:c,paymentMethods:u}=we(),{toast:x}=Ne(),[j,y]=i.useState(!1),[B,C]=i.useState(null),[R,O]=i.useState(1),[v,A]=i.useState(""),[r,d]=i.useState("date-desc"),[g,H]=i.useState(!1),ee=i.useMemo(()=>h.filter(a=>a.tipo==="receita"),[h]),[t,M]=Re(`filter_${Qe}`,()=>({periodType:"monthly",dateRange:void 0,month:new Date().getMonth(),year:new Date().getFullYear()})),ae=a=>{M({...t,dateRange:a})},se=a=>{M({dateRange:void 0,periodType:"monthly",month:a,year:t.year||new Date().getFullYear()})},te=a=>{M(n=>({...n,dateRange:void 0,year:a}))},re=a=>{M(n=>({...n,periodType:a,dateRange:void 0}))},{filteredIncomes:p,totalIncome:ne,trendData:P,averageIncome:oe,maxIncome:le}=i.useMemo(()=>{let a=[],n,m;t.dateRange&&t.dateRange.from?(n=t.dateRange.from,m=t.dateRange.to||t.dateRange.from):t.periodType==="yearly"&&t.year?(n=Ve(new Date(t.year,0,1)),m=Ye(new Date(t.year,11,31))):t.periodType==="monthly"&&t.month!==void 0&&t.year&&(n=T(new Date(t.year,t.month,1)),m=W(new Date(t.year,t.month,1))),n&&m&&(m.setHours(23,59,59,999),a=N.filter(o=>{const l=Z(o.data);return l>=n&&l<=m})),v&&(a=a.filter(o=>o.descricao.toLowerCase().includes(v.toLowerCase()))),a.sort((o,l)=>{switch(r){case"date-asc":return new Date(o.data)-new Date(l.data);case"date-desc":return new Date(l.data)-new Date(o.data);case"value-asc":return o.valor-l.valor;case"value-desc":return l.valor-o.valor;case"description":return o.descricao.localeCompare(l.descricao);default:return new Date(l.data)-new Date(o.data)}});const f=[];for(let o=6;o>=0;o--){const l=t.periodType==="monthly"?new Date(t.year,t.month-o,1):$e(new Date,o),je=T(l),ye=W(l),ve=a.filter(Y=>{const L=Z(Y.data);return L>=je&&L<=ye});f.push(ve.reduce((Y,L)=>Y+L.valor,0))}const _=a.reduce((o,l)=>o+l.valor,0),ge=a.length>0?_/a.length:0,fe=a.length>0?Math.max(...a.map(o=>o.valor)):0;return{filteredIncomes:a,totalIncome:_,trendData:f,averageIncome:ge,maxIncome:fe}},[N,t,v,r]),V=Math.ceil(p.length/z),ce=p.slice((R-1)*z,R*z),ie=async(a,n)=>{try{n?(await k(n,a),x({title:"Receita atualizada com sucesso!"})):(await s(a),x({title:"Receita adicionada com sucesso!"})),y(!1),C(null)}catch(m){x({title:"Erro ao salvar receita",description:m.message,variant:"destructive"})}},de=a=>{C(a),y(!0)},me=async a=>{try{await D(a),x({title:"Receita excluída com sucesso!"})}catch(n){x({title:"Erro ao excluir receita",description:n.message,variant:"destructive"})}},he=a=>{a>0&&a<=V&&O(a)},ue=a=>{a||C(null),y(a)},xe=async a=>{const n=[];for(const m of a){const f=await s(m);f!=null&&f.id&&n.push(f)}return n},pe=async a=>{for(const n of a)await D(n)};return e.jsxs(e.Fragment,{children:[e.jsxs(De,{children:[e.jsx("title",{children:"Controle de Receitas - Lumify"}),e.jsx("meta",{name:"description",content:"Adicione e gerencie suas receitas."})]}),e.jsxs("div",{className:"space-y-3 md:space-y-4 page-top",children:[e.jsx(Ue,{title:"Controle de Receitas",subtitle:"Gerencie suas receitas e acompanhe suas entradas financeiras",actionButton:e.jsx(Ge,{onSubmit:ie,incomeToEdit:B,isOpen:j,onOpenChange:ue})}),e.jsxs(Xe,{defaultValue:"relatorio",className:"w-full",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs(_e,{className:"grid w-full md:w-auto grid-cols-2",children:[e.jsxs(J,{value:"relatorio",className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"})," Relatório"]}),e.jsxs(J,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"})," Dashboard"]})]}),e.jsxs("div",{className:"w-full md:w-auto flex items-center gap-2",children:[e.jsxs(X,{variant:"outline",onClick:()=>H(!0),className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"})," Importar OFX"]}),e.jsx(qe,{periodType:t.periodType,setPeriodType:re,dateRange:t.dateRange,setDateRange:ae,month:t.month,setMonth:se,year:t.year,setYear:te})]})]}),e.jsx(K,{value:"relatorio",className:"mt-4 md:mt-5 space-y-4 md:space-y-5",children:e.jsxs(S,{children:[e.jsxs(b,{children:[e.jsx(I,{children:"Suas Receitas"}),e.jsx(Ce,{children:"Lista de todas as receitas no período selecionado."})]}),e.jsxs(F,{children:[e.jsx(Ie,{transactions:ce,categories:h,accounts:c,paymentMethods:u,type:"income",onEdit:de,onDelete:me,searchTerm:v,onSearchChange:A,sortBy:r,onSortChange:d}),V>1&&e.jsx(Fe,{currentPage:R,totalPages:V,onPageChange:he})]})]})}),e.jsx(K,{value:"dashboard",className:"mt-4 md:mt-5 space-y-4 md:space-y-5",children:e.jsxs("div",{className:"grid gap-3 md:gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(S,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(I,{className:"text-sm font-medium",children:"Total de Receitas"}),e.jsx(E,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(F,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:q(ne)}),e.jsx(w.Sparklines,{data:P,children:e.jsx(w.SparklinesLine,{color:"#22c55e"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total de receitas no período selecionado."})]})]}),e.jsxs(S,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(I,{className:"text-sm font-medium",children:"Número de Receitas"}),e.jsx(G,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(F,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.length}),e.jsx(w.Sparklines,{data:P.map((a,n)=>p.length>0?p.length/P.length:0),children:e.jsx(w.SparklinesLine,{color:"#3b82f6"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Quantidade de receitas registradas."})]})]}),e.jsxs(S,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(I,{className:"text-sm font-medium",children:"Receita Média"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(F,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.length>0?q(oe):"R$ 0,00"}),e.jsx(w.Sparklines,{data:P.map(a=>a/(p.length||1)),children:e.jsx(w.SparklinesLine,{color:"#fbbf24"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Valor médio por receita."})]})]}),e.jsxs(S,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(I,{className:"text-sm font-medium",children:"Maior Receita"}),e.jsx(G,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(F,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:p.length>0?q(le):"R$ 0,00"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Maior valor recebido no período."})]})]})]})})]}),e.jsx(ze,{isOpen:g,onOpenChange:H,type:"income",categories:ee,existingTransactions:N,onImport:xe,onUndoImport:pe,onClose:()=>H(!1)})]})]})}export{ma as IncomesPage};
